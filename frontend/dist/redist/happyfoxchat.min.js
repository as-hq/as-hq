window.HFCGlobals||(window.HFCGlobals={}),window.HFCGlobals.runJQueryDependents=function(a){var b={};b.$=window.$,b.jQuery=window.jQuery,window.$=window.jQuery=a,function(){"use strict";function a(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b,c,d){for(var e=0,f=a.length,g=[],h=void 0;f>e&&(h=b.next(a[e]));)b=h,e++;if(e>=f)return[];for(;f-1>e;)h=new n(d),g.push(h),b.on(a[e],h),b=h,e++;return h=new n(c),g.push(h),b.on(a[f-1],h),g}function d(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(a.__proto__=b)}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a){return a instanceof r||a instanceof F}function g(a){return a}function h(a,b){return"url"===b?"_blank":null}function i(a){return a=a||{},{attributes:a.linkAttributes||null,defaultProtocol:a.defaultProtocol||"http",events:a.events||null,format:a.format||g,formatHref:a.formatHref||g,newLine:a.newLine||!1,nl2br:!!a.newLine||a.nl2br||!1,tagName:a.tagName||"a",target:a.target||h,linkClass:a.linkClass||"linkified"}}function j(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;b>d;d++)c[d-1]=arguments[d];return"function"==typeof a?a.apply(void 0,c):a}function k(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b["default"]=a,b}var l={__esModule:!0},m=function(){function a(c){b(this,a),this.j=[],this.T=c||null}return a.prototype.on=function(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)this.j.push([a[c],b]);else this.j.push([a,b])},a.prototype.next=function(a){for(var b=0;b<this.j.length;b++){var c=this.j[b],d=c[1];if(this.test(a,c[0]))return d}return!1},a.prototype.accepts=function(){return!!this.T},a.prototype.test=function(a,b){return a===b},a.prototype.emit=function(){return this.T},a}(),n=function(c){function d(){b(this,d),null!=c&&c.apply(this,arguments)}return a(d,c),d.prototype.test=function(a,b){return a===b||b instanceof RegExp&&b.test(a)},d}(m),o=function(c){function d(){b(this,d),null!=c&&c.apply(this,arguments)}return a(d,c),d.prototype.test=function(a,b){return a instanceof b},d}(m);l.CharacterState=n,l.TokenState=o,l.stateify=c;var p={__esModule:!0},q=function(){function a(b){e(this,a),this.v=b}return a.prototype.toString=function(){return this.v+""},a}(),r=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),s=function(a){function b(){e(this,b),a.call(this,"@")}return d(b,a),b}(q),t=function(a){function b(){e(this,b),a.call(this,":")}return d(b,a),b}(q),u=function(a){function b(){e(this,b),a.call(this,".")}return d(b,a),b}(q),v=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),w=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),x=function(a){function b(){e(this,b),a.call(this,"\n")}return d(b,a),b}(q),y=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),z=function(a){function b(){e(this,b),a.call(this,"+")}return d(b,a),b}(q),A=function(a){function b(){e(this,b),a.call(this,"#")}return d(b,a),b}(q),B=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),C=function(a){function b(){e(this,b),a.call(this,"?")}return d(b,a),b}(q),D=function(a){function b(){e(this,b),a.call(this,"/")}return d(b,a),b}(q),E=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),F=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),G=function(a){function b(){e(this,b),null!=a&&a.apply(this,arguments)}return d(b,a),b}(q),H={Base:q,DOMAIN:r,AT:s,COLON:t,DOT:u,PUNCTUATION:v,LOCALHOST:w,NL:x,NUM:y,PLUS:z,POUND:A,QUERY:C,PROTOCOL:B,SLASH:D,SYM:E,TLD:F,WS:G},I=function(){function a(b){e(this,a),this.v=b,this.type="token",this.isLink=!1}return a.prototype.toString=function(){for(var a=[],b=0;b<this.v.length;b++)a.push(this.v[b].toString());return a.join("")},a.prototype.toHref=function(){return this.toString()},a.prototype.toObject=function(a){return{type:this.type,value:this.toString(),href:this.toHref(void 0===a?"http":a)}},a}(),J=function(a){function b(c){e(this,b),a.call(this,c),this.type="email",this.isLink=!0}return d(b,a),b.prototype.toHref=function(){return"mailto:"+this.toString()},b}(I),K=function(a){function b(c){e(this,b),a.call(this,c),this.type="text"}return d(b,a),b}(I),L=function(a){function b(c){e(this,b),a.call(this,c),this.type="nl"}return d(b,a),b}(I),M=function(a){function b(c){e(this,b),a.call(this,c),this.type="url",this.isLink=!0}return d(b,a),b.prototype.toHref=function(a){a=void 0===a?"http":a;for(var b=!1,c=!1,d=this.v,e=[],g=0;d[g]instanceof B;)b=!0,e.push(d[g].toString().toLowerCase()),g++;for(;d[g]instanceof D;)c=!0,e.push(d[g].toString()),g++;for(;f(d[g]);)e.push(d[g].toString().toLowerCase()),g++;for(;g<d.length;g++)e.push(d[g].toString());return e=e.join(""),b||c||(e=a+"://"+e),e},b.prototype.hasProtocol=function(){return this.v[0]instanceof B},b}(I),N={Base:I,EMAIL:J,NL:L,TEXT:K,URL:M};p.text=H,p.multi=N;var O={__esModule:!0},P=p,Q=l,R=function(a){return new Q.TokenState(a)},S=P.text.DOMAIN,T=P.text.AT,U=P.text.COLON,V=P.text.DOT,W=P.text.PUNCTUATION,X=P.text.LOCALHOST,Y=P.text.NL,Z=P.text.NUM,$=P.text.PLUS,_=P.text.POUND,aa=P.text.PROTOCOL,ba=P.text.QUERY,ca=P.text.SLASH,da=P.text.SYM,ea=P.text.TLD,fa=P.multi.EMAIL,ga=P.multi.NL,ha=P.multi.TEXT,ia=P.multi.URL,ja=R(),ka=R(),la=R(),ma=R(),na=R(),oa=R(),pa=R(ia),qa=R(),ra=R(ia),sa=R(),ta=R(),ua=R(ia),va=R(),wa=R(ia),xa=R(ia),ya=R(),za=R(),Aa=R(),Ba=R(fa),Ca=R(),Da=R(fa),Ea=R(),Fa=R(),Ga=R(),Ha=R(ga);ja.on(Y,Ha),ja.on(aa,ka),ja.on(ca,la),ka.on(ca,la),la.on(ca,ma),ja.on(ea,na),ja.on(S,na),ja.on(X,pa),ja.on(Z,na),ma.on(ea,sa),ma.on(S,sa),ma.on(Z,sa),ma.on(X,ua),na.on(V,oa),sa.on(V,ta),za.on(V,Aa),oa.on(ea,pa),oa.on(S,na),oa.on(Z,na),oa.on(X,na),ta.on(ea,ua),ta.on(S,sa),ta.on(Z,sa),ta.on(X,sa),Aa.on(ea,Ba),Aa.on(S,za),Aa.on(Z,za),Aa.on(X,za),pa.on(V,oa),ua.on(V,ta),Ba.on(V,Aa),pa.on(U,qa),pa.on(ca,xa),qa.on(Z,ra),ra.on(ca,xa),ua.on(U,va),ua.on(ca,xa),va.on(Z,wa),wa.on(ca,xa),Ba.on(U,Ca),Ca.on(Z,Da);var Ia=[S,T,X,Z,$,_,aa,ca,ea,da],Ja=[U,V,ba,W];xa.on(Ia,xa),ya.on(Ia,xa),xa.on(Ja,ya),ya.on(Ja,ya);var Ka=[S,Z,$,_,ba,da,ea];na.on(Ka,Ea),na.on(T,Fa),oa.on(Ka,Ea),pa.on(Ka,Ea),pa.on(T,Fa),Ea.on(Ka,Ea),Ea.on(T,Fa),Ea.on(V,Ga),Ga.on(Ka,Ea),Fa.on(ea,za),Fa.on(S,za),Fa.on(X,Ba);var La=function(a){for(var b=a.length,c=0,d=[],e=[];b>c;){for(var f=ja,g=null,h=null,i=0,j=null,k=-1;b>c&&!(g=f.next(a[c]));)e.push(a[c++]);for(;b>c&&(h=g||f.next(a[c]));)g=null,f=h,f.accepts()?(k=0,j=f):k>=0&&k++,c++,i++;if(0>k)for(i=c-i;c>i;i++)e.push(a[i]);else 0<e.length&&(d.push(new ha(e)),e=[]),c-=k,i-=k,f=j.emit(),d.push(new f(a.slice(c-i,c)))}return 0<e.length&&d.push(new ha(e)),d},Ma=P.multi,Na=ja;O.State=Q.TokenState,O.TOKENS=Ma,O.run=La,O.start=Na;var Oa={__esModule:!0},Pa=p,Qa=l,Ra="abogado ac academy accountants active actor ad adult ae aero af ag agency ai airforce al allfinanz alsace am an android ao aq aquarelle ar archi army arpa as asia associates at attorney au auction audio autos aw ax axa az ba band bar bargains bayern bb bd be beer berlin best bf bg bh bi bid bike bio biz bj black blackfriday bloomberg blue bm bmw bn bnpparibas bo boo boutique br brussels bs bt budapest build builders business buzz bv bw by bz bzh ca cab cal camera camp cancerresearch capetown capital caravan cards care career careers casa cash cat catering cc cd center ceo cern cf cg ch channel cheap christmas chrome church ci citic city ck cl claims cleaning click clinic clothing club cm cn co coach codes coffee college cologne com community company computer condos construction consulting contractors cooking cool coop country cr credit creditcard cricket crs cruises cu cuisinella cv cw cx cy cymru cz dad dance dating day de deals degree delivery democrat dental dentist desi diamonds diet digital direct directory discount dj dk dm dnp do domains durban dvag dz eat ec edu education ee eg email emerck energy engineer engineering enterprises equipment er es esq estate et eu eurovision eus events everbank exchange expert exposed fail farm fashion feedback fi finance financial firmdale fish fishing fitness fj fk flights florist flsmidth fly fm fo foo forsale foundation fr frl frogans fund furniture futbol ga gal gallery gb gbiz gd ge gent gf gg gh gi gift gifts gives gl glass gle global globo gm gmail gmo gmx gn google gop gov gp gq gr graphics gratis green gripe gs gt gu guide guitars guru gw gy hamburg haus healthcare help here hiphop hiv hk hm hn holdings holiday homes horse host hosting house how hr ht hu ibm id ie il im immo immobilien in industries info ing ink institute insure int international investments io iq ir irish is it je jetzt jm jo jobs joburg jp juegos kaufen ke kg kh ki kim kitchen kiwi km kn koeln kp kr krd kred kw ky kz la lacaixa land latrobe lawyer lb lc lds lease legal lgbt li life lighting limited limo link lk loans london lotto lr ls lt ltda lu luxe luxury lv ly ma madrid maison management mango market marketing mc md me media meet melbourne meme memorial menu mg mh miami mil mini mk ml mm mn mo mobi moda moe monash money mormon mortgage moscow motorcycles mov mp mq mr ms mt mu museum mv mw mx my mz na nagoya name navy nc ne net network neustar new nexus nf ng ngo nhk ni ninja nl no np nr nra nrw nu nyc nz okinawa om ong onl ooo org organic otsuka ovh pa paris partners parts party pe pf pg ph pharmacy photo photography photos physio pics pictures pink pizza pk pl place plumbing pm pn pohl poker porn post pr praxi press pro prod productions prof properties property ps pt pub pw py qa qpon quebec re realtor recipes red rehab reise reisen reit ren rentals repair report republican rest restaurant reviews rich rio rip ro rocks rodeo rs rsvp ru ruhr rw ryukyu sa saarland sarl sb sc sca scb schmidt schule science scot sd se services sexy sg sh shiksha shoes si singles sj sk sl sm sn so social software sohu solar solutions soy space spiegel sr st su supplies supply support surf surgery suzuki sv sx sy sydney systems sz taipei tatar tattoo tax tc td technology tel tf tg th tienda tips tirol tj tk tl tm tn to today tokyo tools top town toys tp tr trade training travel trust tt tui tv tw tz ua ug uk university uno uol us uy uz va vacations vc ve vegas ventures versicherung vet vg vi viajes villas vision vlaanderen vn vodka vote voting voto voyage vu wales wang watch webcam website wed wedding wf whoswho wien wiki williamhill wme work works world ws wtc wtf xxx xyz yachts yandex ye yoga yokohama youtube yt za zip zm zone zw".split(" "),Sa=/[0-9]/,Ta=/[a-z0-9]/,Ua=":",Va=[],Wa=function(a){return new Qa.CharacterState(a)},Xa=Pa.text.DOMAIN,Ya=Pa.text.LOCALHOST,Za=Pa.text.NUM,$a=Pa.text.PROTOCOL,_a=Pa.text.TLD,ab=Pa.text.WS,bb=Wa(),cb=Wa(Za),db=Wa(Xa),eb=Wa(),fb=Wa(ab);bb.on("@",Wa(Pa.text.AT)),bb.on(".",Wa(Pa.text.DOT)),bb.on("+",Wa(Pa.text.PLUS)),bb.on("#",Wa(Pa.text.POUND)),bb.on("?",Wa(Pa.text.QUERY)),bb.on("/",Wa(Pa.text.SLASH)),bb.on(Ua,Wa(Pa.text.COLON)),bb.on(/[,;!]/,Wa(Pa.text.PUNCTUATION)),bb.on(/\n/,Wa(Pa.text.NL)),bb.on(/\s/,fb),fb.on(/[^\S\n]/,fb);for(var gb=0;gb<Ra.length;gb++){var hb=Qa.stateify(Ra[gb],bb,_a,Xa);Va.push.apply(Va,hb)}var ib=Qa.stateify("file",bb,Xa,Xa),jb=Qa.stateify("ftp",bb,Xa,Xa),kb=Qa.stateify("http",bb,Xa,Xa);Va.push.apply(Va,ib),Va.push.apply(Va,jb),Va.push.apply(Va,kb);var lb=ib.pop(),mb=jb.pop(),nb=kb.pop(),ob=Wa(Xa),pb=Wa($a);mb.on("s",ob),nb.on("s",ob),Va.push(ob),lb.on(Ua,pb),mb.on(Ua,pb),nb.on(Ua,pb),ob.on(Ua,pb);var qb=Qa.stateify("localhost",bb,Ya,Xa);for(Va.push.apply(Va,qb),bb.on(Sa,cb),cb.on("-",eb),cb.on(Sa,cb),cb.on(Ta,db),db.on("-",eb),db.on(Ta,db),gb=0;gb<Va.length;gb++)Va[gb].on("-",eb),Va[gb].on(Ta,db);eb.on("-",eb),eb.on(Sa,db),eb.on(Ta,db),bb.on(/./,Wa(Pa.text.SYM));var rb=function(a){for(var b=a.toLowerCase(),c=a.length,d=0,e=[];c>d;){for(var f=bb,g=null,h=0,i=null,j=-1;c>d&&(g=f.next(b[d]));)f=g,f.accepts()?(j=0,i=f):j>=0&&j++,h++,d++;0>j||(d-=j,h-=j,f=i.emit(),e.push(new f(a.substr(d-h,h))))}return e},sb=bb;Oa.State=Qa.CharacterState,Oa.TOKENS=Pa.text,Oa.run=rb,Oa.start=sb;var tb={__esModule:!0};tb.normalize=i,tb.resolve=j;var ub={__esModule:!0},vb=tb,wb=k(vb),xb=Oa,yb=k(xb),zb=O,Ab=k(zb);Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var Bb=function(a){return Ab.run(yb.run(a))},Cb=function(a,b){for(var c=void 0===b?null:b,d=Bb(a),e=[],f=0;f<d.length;f++)!d[f].isLink||c&&d[f].type!==c||e.push(d[f].toObject());return e},Db=function(a,b){var c=void 0===b?null:b,d=Bb(a);return 1===d.length&&d[0].isLink&&(!c||d[0].type===c)};ub.find=Cb,ub.options=wb,ub.parser=Ab,ub.scanner=yb,ub.test=Db,ub.tokenize=Bb,window.linkify=ub}(),function(a,b){"use strict";function c(a,b,c){var d=c[c.length-1];a.replaceChild(d,b);for(var e=c.length-2;e>=0;e--)a.insertBefore(c[e],d),d=c[e]}function d(a,b,c){for(var d=[],e=0;e<a.length;e++){var f=a[e];if(f.isLink){var g=f.toHref(b.defaultProtocol),h=i.resolve(b.format,f.toString(),f.type),j=i.resolve(b.formatHref,g,f.type),k=i.resolve(b.attributes,g,f.type),l=i.resolve(b.tagName,g,f.type),m=i.resolve(b.linkClass,g,f.type),n=i.resolve(b.target,g,f.type),o=i.resolve(b.events,g,f.type),p=c.createElement(l);if(p.setAttribute("href",j),p.setAttribute("class",m),n&&p.setAttribute("target",n),k)for(var q in k)p.setAttribute(q,k[q]);if(o)for(var r in o)p.addEventListener?p.addEventListener(r,o[r]):p.attachEvent&&p.attachEvent("on"+r,o[r]);p.appendChild(c.createTextNode(h)),d.push(p)}else d.push("nl"===f.type&&b.nl2br?c.createElement("br"):c.createTextNode(f.toString()))}return d}function e(a,b,f){if(!a||"object"!=typeof a||a.nodeType!==j)throw new Error("Cannot linkify "+a+" - Invalid DOM Node type");if("A"===a.tagName)return a;for(var g=a.firstChild;g;){switch(g.nodeType){case j:e(g,b,f);break;case k:var i=g.nodeValue,l=h(i),m=d(l,b,f);c(a,g,m),g=m[m.length-1]}g=g.nextSibling}return a}function f(a,b){var c=void 0===arguments[2]?null:arguments[2];try{c=c||window&&window.document||global&&global.document}catch(d){}if(!c)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");return b=i.normalize(b),e(a,b,c)}function g(a){function b(a){return a=f.normalize(a),this.each(function(){f.helper(this,a,c)})}var c=void 0===arguments[1]?null:arguments[1];a.fn=a.fn||{};try{c=c||window&&window.document||global&&global.document}catch(d){}if(!c)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");"function"!=typeof a.fn.linkify&&(a.fn.linkify=b,a(c).ready(function(){a("[data-linkify]").each(function(){var b=a(this),c=b.data(),d=c.linkify,e=c.linkifyNlbr,f={linkAttributes:c.linkifyAttributes,defaultProtocol:c.linkifyDefaultProtocol,events:c.linkifyEvents,format:c.linkifyFormat,formatHref:c.linkifyFormatHref,newLine:c.linkifyNewline,nl2br:!!e&&0!==e&&"false"!==e,tagName:c.linkifyTagname,target:c.linkifyTarget,linkClass:c.linkifyLinkclass},g="this"===d?b:b.find(d);g.linkify(f)})}))}var h=b.tokenize,i=b.options,j=1,k=3;f.helper=e,f.normalize=i.normalize;var l=void 0;try{l=document}catch(m){l=null}"undefined"!=typeof a&&l&&g(a,l),window.linkifyElement=f}(window.jQuery,window.linkify),function(a,b,c,d){var e,f;"function"==typeof require&&"object"==typeof module&&module.exports&&(e=!0),"function"==typeof define&&define.amd&&(f=!0);var g=function(a,b,c,d){function f(a){if(h[a])return i[a]=new h[a],i[a];throw new Error("Unknown text type. Please pass only enum values from "+g.plugin.name+".type")}var g={},h={},i={};g.plugin={name:"TextProcessor",version:"0.0.1"},g.type={PLAIN:"plain",MARKDOWN:"markdown"};var j=function(){e?(this.linkifyString=require("linkifyjs/string"),this.stripTags=require("striptags"),this.unescapeHTML=require("unescape-html")):(b&&b.fn&&b.fn.jquery||function(){throw new Error("jQuery is missing. "+g.plugin.name+" needs jQuery. https://github.com/jquery/jquery")}(),b().linkify||function(){throw new Error("jquery.linkify is missing. "+g.plugin.name+" needs jquery.linkify. https://github.com/SoapBox/linkifyjs")}())};j.prototype.process=function(a,c){c||(c={});var d;return e?d=this.linkifyString(a):(c.anchorTarget||(c.anchorTarget="_blank"),d=a?b("<div />").text(a).linkify({target:c.anchorTarget}).html():a),d},j.prototype.reverse=function(a,c){return e?this.unescapeHTML(this.stripTags(a)):b("<div/>").html(a).text()},h[g.type.PLAIN]=j;var k=function(){e?(this.markdown=require("markdown").markdown,this.toMarkdown=require("to-markdown")):(c||function(){throw new Error("markdown is missing. "+g.plugin.name+" needs markdown. https://github.com/evilstreak/markdown-js")}(),d||function(){throw new Error("toMarkdown is missing. "+g.plugin.name+" needs toMarkdown. https://github.com/domchristie/to-markdown.git")}())};return k.prototype.process=function(a,b){b||(b={});var d;return d=e?this.markdown.toHTML(a):c.toHTML(a)},k.prototype.reverse=function(a,b){return e?this.toMarkdown(a):d(a)},h[g.type.MARKDOWN]=k,g.get=function(a){return i[a]||f(a),i[a]},g};if(f){var h=g(a,b,window.markdown,d);define(["jquery","linkify-jquery","markdown","to-markdown"],function(a,b,c,d){return h}),a[h.plugin.name]=h}else if(e)module.exports=g(a,b);else{var h=g(a,b,c,d);a[h.plugin.name]=h}}("object"==typeof window&&window,"function"==typeof a&&a||"function"==typeof jQuery&&jQuery,"object"==typeof markdown&&markdown,"function"==typeof toMarkdown&&toMarkdown);for(var c in b)window[c]=b[c]},function(){function a(){try{var a="hfc";return window.localStorage.setItem(a,a),window.localStorage.removeItem(a),!0}catch(b){return!1}}if(!window.HFLiveChat){var b=window.console,c=function(){},d={_enableLogObj:window.console,_disableLogObj:{log:c,info:c,debug:c,warn:c,error:c,memory:c},enable:function(){return b=this._enableLogObj},disable:function(){return b=this._disableLogObj}};"undefined"!=typeof window.localStorage&&"undefined"!=typeof window.sessionStorage&&a()||function(){var b=function(a){function b(a,b,c){var d,e;c?(d=new Date,d.setTime(d.getTime()+24*c*60*60*1e3),e="; expires="+d.toGMTString()):e="",document.cookie=a+"="+b+e+"; path=/"}function c(a){var b,c,d=a+"=",e=document.cookie.split(";");for(b=0;b<e.length;b++){for(c=e[b];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(d))return c.substring(d.length,c.length)}return null}function d(c){c=JSON.stringify(c),"session"==a?window.name=c:b("localStorage",c,365)}function e(){"session"==a?window.name="":b("localStorage","",365)}function f(){var b="session"==a?window.name:c("localStorage");return b?JSON.parse(b):{}}var g=f();return{length:0,_config:{},config:function(a){a||(a={}),a.prefix&&(this._config.prefix=a.prefix),a.postfix&&(this._config.postfix=a.postfix)},clear:function(){g={},this.length=0,e()},getItem:function(a){return g?(a=(this._config.prefix&&this._config.prefix+"-"||"")+a+(this._config.postfix&&"-"+this._config.postfix||""),void 0===g[a]?null:decodeURIComponent(g[a])):null},key:function(a){var b=0;for(var c in g){if(b==a)return c;b++}return null},removeItem:function(a){a=(this._config.prefix&&this._config.prefix+"-"||"")+a+(this._config.postfix&&"-"+this._config.postfix||""),delete g[a],this.length--,d(g)},setItem:function(a,b){a=(this._config.prefix&&this._config.prefix+"-"||"")+a+(this._config.postfix&&"-"+this._config.postfix||""),g[a]=encodeURIComponent(b+""),this.length++,d(g)}}};"undefined"!=typeof window.localStorage&&a()||(window.hfcStore=new b("local")),"undefined"==typeof window.sessionStorage&&(window.sessionStorage=new b("session"))}(),function(){function a(){var a=b();return a&&(window.HFCHAT_CONFIG=a)}function b(){var a=c(),b=a.src,e=d("ET",{url:b}),f=d("AT",{url:b}),g=d("H",{url:b}),h=d("A",{url:b}),i={EMBED_TOKEN:e,ACCESS_TOKEN:f,HOST_URL:g,ASSETS_URL:h},j=!0;for(var k in i)if(!i[k]){j=!1;break}return j?i:void 0}function c(){if("undefined"!=typeof window.document.currentScript)return window.document.currentScript;var a=["https://d3rxsz7gstov00.cloudfront.net/visitor/js/widget-loader.js","https://happyfoxchat.com/visitor/js/widget-loader.js","https://d1mgayoyaoxsy1.cloudfront.net/visitor/js/widget-loader.js","https://chatstaging.tenmiles.com/js/widget-loader.js","http://localhost:5000/js/widget-loader.js"],b=window.document.getElementsByTagName("script");for(var c in a){var d=a[c];for(var c in b){var e=b[c];if(e.src&&-1!==e.src.indexOf(d))return e}}}function d(a,b){b||(b={});for(var c=(b.url?b.url.match(/(\?.*)/)[1]:window.location.search).substring(1),d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(decodeURIComponent(f[0])==a)return decodeURIComponent(f[1])}}return window.HFCHAT_CONFIG?void 0:a.apply(this,arguments)}(),function(a){function c(a,b){b||(b={});for(var c=(b.url?b.url.match(/(\?.*)/)[1]:window.location.search).substring(1),d=c.split("&"),e=0;e<d.length;e++){var f=d[e].split("=");if(decodeURIComponent(f[0])==a)return decodeURIComponent(f[1])}}function e(a){return this.config(a),this}function f(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function g(){var a=n("meta[name='viewport']");return a.length>0&&(-1!==a.attr("content").indexOf("initial-scale=1")||-1!==a.attr("content").indexOf("width=device-width"))?!0:!1}function h(b){var c=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return a.overrides?b&&b.overrideConfig?c:a.overrides.mobileMode?!1:c:c}function i(c){if(c.origin===a.HOST_URL){var d,e=window.$hfchatFrame[0].contentWindow,f=JSON.parse(c.data),g=f.event,h=null;switch(f.hasOwnProperty("data")&&(h=f.data),"hfc-server-online"!==g&&b.log("New message from iframe",g,h),g){case"hfc-ready":var i=window.hfcStore.getItem("hfc-embed-token");i!=a.EMBED_TOKEN&&z.resetCurrentUser();var j=z.checkForExistingUser();if(z.IsRepeatedVisitor=j,d="true"===window.hfcStore.getItem("hfc-active"),!d){var k=window.hfcStore.getItem("hfc-version");k!==p&&(b.log("Widget version mismatch. Current: ",k,"Expected: ",p),z.resetCurrentUser(),window.hfcStore.setItem("hfc-version",p))}f={event:d?"hfc-init":"hfc-ping",data:{DEBUG:a.DEBUG,EMBED_TOKEN:a.EMBED_TOKEN,ACCESS_TOKEN:a.ACCESS_TOKEN,API_HOST_URL:a.HOST_URL,HOST_URL:window.location.protocol+"//"+window.location.host,FULL_URL:window.location.href,stats:q.getTrackingInfo(),user_exists:j},replyEvent:"hfc-initComplete"},z.currentUser&&z.currentUser.name&&(f.data.name=z.currentUser.name),z.currentUser&&z.currentUser.email&&(f.data.email=z.currentUser.email),j&&z.currentUser.accessToken&&(b.log("User already exists with access token",z.currentUser.accessToken),f.data.visitor_access_token=z.currentUser.accessToken),e.postMessage(JSON.stringify(f),a.HOST_URL),A.setupHFChatEvents(),z.iframeReadyDeferred.resolve();break;case"hfc-initComplete":if(f.error)b.log("Init failed!");else{if(d="true"===window.hfcStore.getItem("hfc-active"),f.data.error)return void b.log("Error creating session. Hiding chat widget");if(z.companyReferralCode=f.data.companyReferralCode,f.data.hide_chat_widget&&(!d||f.data.data&&0===f.data.data.client_state.joined_agents.length))return void b.log("Hiding chat widget");z.proactiveConditions=f.data.proactive_chats,n(z).trigger(z.EVENTS.READY,{data:f.data}),f.data.agents_available?n(z).trigger(z.EVENTS.AGENTS_AVAILABILITY_CHANGED,{available:!0}):n(z).trigger(z.EVENTS.AGENTS_AVAILABILITY_CHANGED,{available:!1}),f.data.session_token&&(z.currentUser.sessionToken=f.data.session_token),f.data.access_token&&(z.currentUser.accessToken=f.data.access_token),f.data.visitor_id&&(z.currentUser.visitorId=f.data.visitor_id),f.data.apps&&(r.registerPlugins(f.data.apps),z.integrationInfo=f.data.apps),z.saveCurrentUserInfo(),z.currentUser.email&&z.getIntegrationInfo(z.currentUser.name,z.currentUser.email),f.data.session_available&&z.newSessionAvailable(f.data.error,f.data.data),a.onload&&n.isFunction(a.onload)&&a.onload.apply(r),z.setInfo({"user.is_repeated":z.IsRepeatedVisitor,"user.is_engaged":!1}),z.validateEngageRequest({addMessages:!0})}break;case"hfc-updateVisitorDetails":r._trigger(r.EVENTS.CHAT_STARTED),z.currentUser.sessionToken=f.data.sessionToken,z.currentUser.accessToken=f.data.accessToken,z.currentUser.visitorId=f.data.visitorId,z.saveCurrentUserInfo();break;case"hfc-sessionReconnected":if(f.data.error)return void b.log("Reconnect failed");f.data.session_token&&(z.currentUser.sessionToken=f.data.session_token),f.data.access_token&&(z.currentUser.accessToken=f.data.access_token),f.data.visitor_id&&(z.currentUser.visitorId=f.data.visitor_id),z.saveCurrentUserInfo(),z.setupNotifications(),f.data.data&&(f.data.data.reconnected=!0),n(z).trigger(z.EVENTS.SESSION_CREATED,f.data.data);break;case"hfc-registeredVisitor":h.error?b.log("Unable to register visitor"):z.registeredVisitor();break;case"hfc-fetchedVisitorIntegrationInfo":h.error?b.log("Unable to fetch visitor integration info"):z.visitorIntegrationInfo=h.result;break;case"hfc-agentAvailability":A.handleAvailability(f.data.agents_available);break;case"hfc-server-online":A.clearOfflineBanner();break;case"hfc-server-offline":A.showOfflineBanner();break;case"hfc-typingStatusUpdated":z.typingStatusUpdated(h);break;case"hfc-visitorMessageAdded":z.visitorMessageAdded(f.data.id);break;case"hfc-notificationsReceived":z.handleNotifications(h);break;case"hfc-visitorDeactivated":z.updateCurrentUserState(!1),A.showConversationView(),A.$minimizedViewContainer.find(".hfc-badge-title").text(A.messages.HEADER.MINIMIZED_ONLINE_MESSAGE),A.$chatWindowTitleBar.find(".hfc-chat-ended-label").show();break;case"hfc-receivedAgentDisplayImage":A.setAgentDisplayImage(h);break;case"hfc-offlineMessageSent":A.showOfflineSuccessPage(),r._trigger(r.EVENTS.OFFLINE_MESSAGE_SENT);break;case"hfc-setInfo":z.setInfo(h.properties);break;case"hfc-setInfo-reply":b.log("Successfully setted visitor info!",h.status,h.data);break;case"hfc-setState":z.setState(h.state);break;case"hfc-setState-reply":b.log("Successfully setted state!",h.status,h.data);break;case"hfc-agentSentEngageRequest":z.handleAgentEngageRequest(h);break;case"hfc-unsetEngageRequest":z.endEngageChat();break;case"hfc-engageRequestAccepted":z.acceptEngageRequest(),A.showAgentDisplayImage();break;case"hfc-createdNewVisitorInfoSession":z.setInfo(z.getInfo());break;case"hfc-chatAPINotificationLoop":z.updateChatAPINotifLoopTimestamp()}}}function j(a,b){a||(a={});var c=document.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",a.src),c.readyState?c.onreadystatechange=function(){("complete"===this.readyState||"loaded"===this.readyState)&&b(c)}:c.onload=function(){b(c)},(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(c)}function k(a){function b(a){window.jQuery&&window.jQuery.fn&&"1.9.1"===window.jQuery.fn.jquery?(e=!0,a()):(e=!1,j({src:"https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"},a))}function c(){n=o=e?window.jQuery:window.jQuery.noConflict(!0)}function d(a){HFCGlobals.TextProcessor=window.TextProcessor,delete window.TextProcessor,HFCGlobals.linkify=window.linkify,delete window.linkify,HFCGlobals.linkifyElement=window.linkifyElement,delete window.linkifyElement}var e=!1;b(function(){c(),HFCGlobals.runJQueryDependents(n),d(),a()})}function l(){function c(){var c=-1!==a.HOST_URL.indexOf("localhost"),e=-1!==a.HOST_URL.indexOf("happyfoxchat.com"),f=a.HOST_URL+"/widget/";c||(f+="dist/"),e&&d.disable();var g=n("<div id='hfchat-wrapper'></div>"),h=n("<iframe></iframe>").attr("src",f+"widget.html");g.appendTo("body:first"),g.hide();var i=n("<link>",{rel:"stylesheet",type:"text/css",href:a.ASSETS_URL+"/styles/embed.css"});i.appendTo("head"),h.appendTo(g),window.$hfchatFrame=h,q.track(),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(o)}(function(a){function c(a){window.console&&b.warn&&b.warn(a)}var d=function(b,c){d._registry.push(this),this.$textarea=b,this.$textCopy=a("<span />"),this.$clone=a("<pre class='expanding-clone'><br /></pre>").prepend(this.$textCopy),this._resetStyles(),this._setCloneStyles(),this._setTextareaStyles(),b.wrap(a("<div class='expanding-wrapper' style='position:relative' />")).after(this.$clone),this.attach(),this.update(),c.update&&b.bind("update.expanding",c.update)};d._registry=[],d.getExpandingInstance=function(b){var c=a.map(d._registry,function(a){return a.$textarea[0]}),e=a.inArray(b,c);return e>-1?d._registry[e]:null};var e=function(){var a=-1;if("Microsoft Internet Explorer"===navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[\\.0-9]{0,})");null!==c.exec(b)&&(a=parseFloat(RegExp.$1))}return a}(),f="oninput"in document.createElement("input")&&9!==e;d.prototype={attach:function(){var a="input.expanding change.expanding",b=this;f||(a+=" keyup.expanding"),this.$textarea.bind(a,function(){b.update()})},update:function(){this.$textCopy.text(this.$textarea.val().replace(/\r\n/g,"\n")),this.$textarea.triggerHandler("update.expanding")},destroy:function(){this.$clone.remove(),this.$textarea.unwrap().attr("style",this._oldTextareaStyles||""),delete this._oldTextareaStyles;var b=a.inArray(this,d._registry);b>-1&&d._registry.splice(b,1),this.$textarea.unbind("input.expanding change.expanding keyup.expanding update.expanding")},_resetStyles:function(){this._oldTextareaStyles=this.$textarea.attr("style"),this.$textarea.add(this.$clone).css({margin:0,webkitBoxSizing:"border-box",mozBoxSizing:"border-box",boxSizing:"border-box",width:"100%"})},_setCloneStyles:function(){var a={display:"block",border:"0 solid",visibility:"hidden",minHeight:this.$textarea.outerHeight()};"off"===this.$textarea.attr("wrap")?a.overflowX="scroll":a.whiteSpace="pre-wrap",this.$clone.css(a),this._copyTextareaStylesToClone()},_copyTextareaStylesToClone:function(){var b=this,c=["lineHeight","textDecoration","letterSpacing","fontSize","fontFamily","fontStyle","fontWeight","textTransform","textAlign","direction","wordSpacing","fontSizeAdjust","wordWrap","word-break","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","paddingLeft","paddingRight","paddingTop","paddingBottom","maxHeight"];a.each(c,function(a,c){var d=b.$textarea.css(c);b.$clone.css(c)!==d&&(b.$clone.css(c,d),"maxHeight"===c&&"none"!==d&&b.$clone.css("overflow","hidden"))})},_setTextareaStyles:function(){this.$textarea.css({position:"absolute",top:0,left:0,height:"100%",resize:"none",overflow:"auto"})}},a.expanding=a.extend({autoInitialize:!0,initialSelector:"textarea.expanding",opts:{update:function(){}}},a.expanding||{}),a.fn.expanding=function(b){if("destroy"===b)return this.each(function(){var a=d.getExpandingInstance(this);a&&a.destroy()}),this;if("active"===b)return!!this.filter(function(){return!!d.getExpandingInstance(this)}).length;var e=a.extend({},a.expanding.opts,b);return this.filter("textarea").each(function(){var b=this.offsetWidth>0||this.offsetHeight>0,f=d.getExpandingInstance(this);b&&!f?new d(a(this),e):(b||c("ExpandingTextareas: attempt to initialize an invisible textarea. Call expanding() again once it has been inserted into the page and/or is visible."),f&&c("ExpandingTextareas: attempt to initialize a textarea that has already been initialized. Subsequent calls are ignored."))}),this},a(function(){a.expanding.autoInitialize&&a(a.expanding.initialSelector).expanding()})})}n(document).ready(function(){
window.setTimeout(function(){c()},1)})}"undefined"==typeof a.overrides&&(a.overrides=null);var m=-1!==a.HOST_URL.indexOf("localhost");("undefined"==typeof a.ASSETS_URL||m)&&(a.ASSETS_URL=a.HOST_URL);var n,o,p="0.1";!window.hfcStore&&window.localStorage&&(e.prototype.config=function(a){return a||(a={}),this._config||(this._config={}),a.prefix&&(this._config.prefix=a.prefix),a.postfix&&(this._config.postfix=a.postfix),this},e.prototype._setItem=window.localStorage.setItem,e.prototype._getItem=window.localStorage.getItem,e.prototype._removeItem=window.localStorage.removeItem,e.prototype.setItem=function(a,b){return a=(this._config.prefix&&this._config.prefix+"-"||"")+a+(this._config.postfix&&"-"+this._config.postfix||""),e.prototype._setItem.call(window.localStorage,a,b)},e.prototype.getItem=function(a){return a=(this._config.prefix&&this._config.prefix+"-"||"")+a+(this._config.postfix&&"-"+this._config.postfix||""),e.prototype._getItem.call(window.localStorage,a)},e.prototype.removeItem=function(a){return a=(this._config.prefix&&this._config.prefix+"-"||"")+a+(this._config.postfix&&"-"+this._config.postfix||""),e.prototype._removeItem.call(window.localStorage,a)},window.hfcStore=new e),window.hfcStore.config({postfix:HFCHAT_CONFIG.ACCESS_TOKEN});var q=window.HFCTracker={MAX_PAGES_TRACKED:10,track:function(){var a=this.getTrackingInfo();a.push(this.fetchData()),a=a.slice(-1*q.MAX_PAGES_TRACKED),window.hfcStore&&window.hfcStore.setItem("hfc-tracking-info",JSON.stringify(a))},fetchData:function(){var a=window.screen?window.screen.width:n(document).width(),b=window.screen?window.screen.height:n(document).height();return{pageTitle:document.title,url:document.location.href,referrer:document.referrer,userAgent:window.navigator.userAgent,dimensions:{width:a,height:b},timestamp:(new Date).toUTCString()}},getTrackingInfo:function(){if(!window.hfcStore)return{};var a=window.hfcStore.getItem("hfc-tracking-info")||"[]";return JSON.parse(a)},reset:function(){window.hfcStore.setItem("hfc-tracking-info","")}},r={EVENTS:{CHAT_WIDGET_READY:"hfc.core.ready",CHAT_WINDOW_OPENED:"hfc.ui.chat_window_opened",CHAT_STARTED:"hfc.core.chat_started",AGENT_JOINED:"hfc.core.agent_joined",PROACTIVE_CHAT_TRIGGERED:"hfc.core.proactive_chat_triggered",OFFLINE_MESSAGE_SENT:"hfc.core.offline_message_sent"},_isValidEvent:function(a){var b=a.split("."),c=b[b.length-1].toUpperCase();return"undefined"!=typeof this.EVENTS[c]},init:function(){this._handlers={},this.enabledPlugins=[]},initPlugins:function(){for(var a=0;a<this.enabledPlugins.length;a++){var b=this.enabledPlugins[a];b.plugin.init(b.settings)}},registerPlugins:function(a){this.PLUGINS={"google-analytics":t,shopify:v,segment:u,mixpanel:w,magento:x,woocommerce:y};for(var b=0;b<a.length;b++){var c=a[b];this.PLUGINS[c.name]&&this.enabledPlugins.push({plugin:this.PLUGINS[c.name],name:c.name,settings:c.settings})}this.initPlugins()},_raiseInvalidEventError:function(a){throw new Error(a+" is not a valid event for HappyFoxChat")},register:function(a,b,c){this._isValidEvent(a)?(this._handlers[a]||(this._handlers[a]=[]),this._handlers[a].push({callback:b,context:c?c:this})):this._raiseInvalidEventError(a)},_trigger:function(a){if(this._isValidEvent(a)){if(this._handlers[a]&&this._handlers[a].length>0)for(var b=Array.prototype.slice.call(arguments,1),c=this._handlers[a],d=0;d<c.length;d++){var e=c[d].callback,f=c[d].context;e.apply(f,b)}}else this._raiseInvalidEventError(a)}},s={extend:function(a){var b=s.prototype,c=a;for(var d in b)b.hasOwnProperty(d)&&(c[d]||(c[d]=b[d]));return c}};s.prototype={sendData:function(b){var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-sendSystemMessage",data:JSON.stringify({messageType:"VisitorDataFromIntegration",text:JSON.stringify({appName:this.NAME,data:b})})}),a.HOST_URL)}};var t=s.extend({NAME:"google-analytics",GA_EVENTS:{CHAT_WINDOW_OPENED:"Chat Window opened",CHAT_STARTED:"Chat started",AGENT_JOINED:"Agent joined a chat",PROACTIVE_CHAT_TRIGGERED:"Proactive chat triggered",OFFLINE_MESSAGE_SENT:"Offline message sent"},init:function(a){this.settings=a,this.category="HappyFoxChat",r.register(r.EVENTS.CHAT_WINDOW_OPENED,this.handleChatWindowOpened,this),r.register(r.EVENTS.CHAT_STARTED,this.handleChatStarted,this),r.register(r.EVENTS.AGENT_JOINED,this.handleAgentJoined,this),r.register(r.EVENTS.PROACTIVE_CHAT_TRIGGERED,this.handleProactiveChatTriggered,this),r.register(r.EVENTS.OFFLINE_MESSAGE_SENT,this.handleOfflineMessageSent,this),window.ga?this.ga=window.ga:b&&b.warn&&b.warn("HappyFox Chat: Unable to find Google Analytics tracking code")},track:function(a,b,c){this.ga&&this.ga("send","event",this.category,a,b,c)},handleChatWindowOpened:function(){this.track(this.GA_EVENTS.CHAT_WINDOW_OPENED)},handleChatStarted:function(){this.track(this.GA_EVENTS.CHAT_STARTED)},handleAgentJoined:function(a){this.track(this.GA_EVENTS.AGENT_JOINED,a)},handleProactiveChatTriggered:function(a){this.track(this.GA_EVENTS.PROACTIVE_CHAT_TRIGGERED,a)},handleOfflineMessageSent:function(){this.track(this.GA_EVENTS.OFFLINE_MESSAGE_SENT)}}),u=s.extend({NAME:"segment",SEGMENT_EVENTS:{CHAT_WINDOW_OPENED:"Chat Window opened",CHAT_STARTED:"Chat started",AGENT_JOINED:"Agent joined a chat",PROACTIVE_CHAT_TRIGGERED:"Proactive chat triggered",OFFLINE_MESSAGE_SENT:"Offline message sent"},init:function(a){this.settings=a,r.register(r.EVENTS.CHAT_WINDOW_OPENED,this.handleChatWindowOpened,this),r.register(r.EVENTS.CHAT_STARTED,this.handleChatStarted,this),r.register(r.EVENTS.AGENT_JOINED,this.handleAgentJoined,this),r.register(r.EVENTS.PROACTIVE_CHAT_TRIGGERED,this.handleProactiveChatTriggered,this),r.register(r.EVENTS.OFFLINE_MESSAGE_SENT,this.handleOfflineMessageSent,this),window.analytics?this.analytics=window.analytics:b&&b.warn&&b.warn("HappyFox Chat: Unable to find Segment tracking code")},track:function(a,b){this.analytics&&this.analytics.track(a,b)},handleChatWindowOpened:function(){this.track(this.SEGMENT_EVENTS.CHAT_WINDOW_OPENED)},handleChatStarted:function(){this.track(this.SEGMENT_EVENTS.CHAT_STARTED)},handleAgentJoined:function(a){this.track(this.SEGMENT_EVENTS.AGENT_JOINED,{agent:a})},handleProactiveChatTriggered:function(a){this.track(this.SEGMENT_EVENTS.PROACTIVE_CHAT_TRIGGERED,{trigger:a})},handleOfflineMessageSent:function(){this.track(this.SEGMENT_EVENTS.OFFLINE_MESSAGE_SENT)}}),v=s.extend({NAME:"shopify",init:function(a){this.settings=a,r.register(r.EVENTS.CHAT_STARTED,this.updateShopifyCartInfo,this),this.shopify=null,window.Shopify?(this.shopify=window.Shopify,this.updateShopifyCartInfo()):b&&b.warn&&b.warn("HappyFox Chat: This is not a Shopify site. Shopify plugin for HappyFox Chat will be disabled")},getShopifyCartInfo:function(a){var b=this;this.shopify?n.getJSON("/cart.js",function(c){b.cartInfo=c,a(!1,c)}):a(new Error("Unable to fetch cart info from Shopify"))},updateShopifyCartInfo:function(){var a=this;this.getShopifyCartInfo(function(c,d){c?b.error("Error fetching shopify cart info"):(b.log("Sending cart info from Shopify",d),a.sendData(d))})}}),w=s.extend({NAME:"mixpanel",MIXPANEL_EVENTS:{CHAT_WINDOW_OPENED:"Chat Window opened",CHAT_STARTED:"Chat started",AGENT_JOINED:"Agent joined a chat",PROACTIVE_CHAT_TRIGGERED:"Proactive chat triggered",OFFLINE_MESSAGE_SENT:"Offline message sent"},init:function(a){this.settings=a,this.category="HappyFoxChat",r.register(r.EVENTS.CHAT_WINDOW_OPENED,this.handleChatWindowOpened,this),r.register(r.EVENTS.CHAT_STARTED,this.handleChatStarted,this),r.register(r.EVENTS.AGENT_JOINED,this.handleAgentJoined,this),r.register(r.EVENTS.PROACTIVE_CHAT_TRIGGERED,this.handleProactiveChatTriggered,this),r.register(r.EVENTS.OFFLINE_MESSAGE_SENT,this.handleOfflineMessageSent,this),window.mixpanel?this.mixpanel=window.mixpanel:b&&b.warn&&b.warn("HappyFox Chat: Unable to find mixpanel tracking code")},track:function(a,b){this.mixpanel&&this.mixpanel.track(a,b)},handleChatWindowOpened:function(){this.track(this.MIXPANEL_EVENTS.CHAT_WINDOW_OPENED)},handleChatStarted:function(){this.track(this.MIXPANEL_EVENTS.CHAT_STARTED)},handleAgentJoined:function(a){this.track(this.MIXPANEL_EVENTS.AGENT_JOINED,{agent:a})},handleProactiveChatTriggered:function(a){this.track(this.MIXPANEL_EVENTS.PROACTIVE_CHAT_TRIGGERED,{trigger:a})},handleOfflineMessageSent:function(){this.track(this.MIXPANEL_EVENTS.OFFLINE_MESSAGE_SENT)}}),x=s.extend({NAME:"magento",init:function(a){this.settings=a,r.register(r.EVENTS.CHAT_STARTED,this.updateMagentoCartInfo,this),this.magento=null,this.settings&&this.settings.showCartInfo?this.updateMagentoCartInfo():b&&b.warn&&b.warn("HappyFox Chat: This is not a magento store. magento plugin for HappyFox Chat will be disabled")},getMagentoCartInfo:function(a){var c,d=this;try{c=new XMLHttpRequest}catch(e){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}}}c.onreadystatechange=function(){if(4===c.readyState){var e=JSON.parse(c.responseText);d.cartInfo=e,a(!1,e),b.log(e)}},c.open("GET",this.settings.storeUrl+"/integrationinfo?email="+encodeURIComponent(z.currentUser.email),!0),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),c.send()},updateMagentoCartInfo:function(){var a=this;this.getMagentoCartInfo(function(c,d){c?b.error("Error fetching magento cart info"):(b.log("Sending cart info from magento",d),a.sendData(d))})}}),y=s.extend({NAME:"woocommerce",init:function(a){this.settings=a,r.register(r.EVENTS.CHAT_STARTED,this.updateWooCommerceIntegrationInfo,this),this.woocommerce=null,window.woocommerce_params?(this.woocommerce=window.woocommerce_params,this.updateWooCommerceIntegrationInfo()):b&&b.warn&&b.warn("HappyFox Chat: This is not a WooCommerce store. WooCommerce plugin for HappyFox Chat will be disabled")},getWooCommerceIntegrationInfo:function(a){var b=this;this.woocommerce?n.ajax({type:"POST",url:window.woocommerce_params.ajax_url,header:{"Content-Type":"application/x-www-form-urlencoded"},data:{action:"integration_info",email:encodeURIComponent(z.currentUser.email)},success:function(c,d,e){if(200===e.status)try{var f=JSON.parse(c);b.wooCommerceInfo=f,a(!1,f)}catch(g){a(g)}},error:function(b,c,d){a(new Error(d))}}):a(new Error("Unable to fetch integration info from WooCommerce"))},updateWooCommerceIntegrationInfo:function(){var a=this;this.getWooCommerceIntegrationInfo(function(c,d){c?b.error("Error fetching woocommerce cart info"):(b.log("Sending integration info from woocommerce",d),a.sendData(d))})}}),z=window.HFLiveChat={ConsoleControl:d,EVENTS:{READY:"hfchat.core.ready",AGENTS_AVAILABILITY_CHANGED:"hfchat.core.agentsAvailability",REGISTERED:"hfchat.visitor.register",SESSION_CREATED:"hfchat.visitor.session_created",STATE_CHANGED:"hfchat.visitor.state_change",NOTIFICATIONS_RECEIVED:"hfchat.visitor.notifications_received",MESSAGE_SENT:"hfchat.visitor.message_sent",CHAT_WIDGET_STATUS:"hfchat.core.chat_widget_status",PROACTIVE_CONDITION_MATCHED:"hfchat.core.proactive_trigger_matched"},NOTIFICATIONS:{VISITOR_SESSION_BEGAN_EVENT:"VisitorSessionBegan",VISITOR_SESSION_ENDED_EVENT:"VisitorSessionEnded",VISITOR_BECAME_INACTIVE:"VisitorBecameInactive",VISITOR_MESSAGE_EVENT:"VisitorMessage",AGENT_MESSAGE_EVENT:"AgentMessage",VISITOR_SENT_MESSAGE_EVENT:"VisitorSentSystemMessage",AGENT_AVAILABILITY_EVENT:"AgentAvailability",AGENT_JOINED_EVENT:"AgentJoined",AGENT_SENT_MESSAGE_EVENT:"AgentSentMessage",VISITOR_IS_TYPING_EVENT:"VisitorIsTyping",AGENT_IS_TYPING_EVENT:"AgentIsTyping",AGENT_LEFT_EVENT:"AgentLeft",VISITOR_DEACTIVATED_EVENT:"Deactivated",AGENT_ENGAGE_MESSAGE:"AgentEngageMessage",VISITOR_METADATA_EVENT:"VisitorMetadata",VISITOR_ENGAGE_METADATA_CODE:"engage_chat"},STATES:{PASSIVE:"passive",ON_PRECHAT_FORM_VIEW:"on_prechat_form_view",ON_CHAT_CONVERSATION_VIEW:"on_chat_conversation_view",WAITING_FOR_AGENT:"waiting_for_agent",CHATTING:"chatting",ON_RATING_FORM_VIEW:"on_rating_form_view",ON_OFFLINEMESSAGE_FORM_VIEW:"on_offlinemessage_form_view",ON_CHAT_AGAIN_VIEW:"on_chat_again_view"},state:void 0,hasAgentInteracted:!1,VISITOR_ACTIVE_TIMEOUT:36e5,VISITOR_TYPING_TIMEOUT:2e3,AGENT_TYPING_TIMEOUT:4e3,CONVERSATION_TIMEOUT:239e3,plainTextProcessor:void 0,IsRepeatedVisitor:!1,init:function(){this.currentUser||(this.currentUser={},this.currentUser.name="",this.currentUser.email=""),this.currentUser.newConversation=!0,this.currentAgents={},this.readNotificationCount=0,this.unreadNotificationCount=0,this.plainTextProcessor=HFCGlobals.TextProcessor.get(HFCGlobals.TextProcessor.type.PLAIN),this.visitorIntegrationInfo={},this.integrationInfo={},r.init()},initUser:function(a,b,c){this.currentUser||(this.currentUser={}),this.currentUser.name=a,this.currentUser.email=b,this.unreadNotificationCount=0,this.registerVisitor(a,b,c),this.getIntegrationInfo(a,b)},openCompanyChatPage:function(){var b=a.HOST_URL+"/chat/"+a.EMBED_TOKEN+"?return_to="+document.location.href;window.open(b,"_blank")},checkForRepeatVisitor:function(){var a=q.getTrackingInfo();return a.length>1},setState:function(c){if(this.state!==c){this.state=c,b.log("WidgetLoader: Posting visitor state event to iframe. ",c),hfcStore.setItem("hfc-state",c);var d=window.$hfchatFrame[0].contentWindow;c===z.STATES.PASSIVE&&z.setInfo({"user.agent_chat_id":!1}),z.iframeReadyDeferred.done(function(){d.postMessage(JSON.stringify({event:"hfc-setState",data:{state:c},replyEvent:"hfc-setState-reply"}),a.HOST_URL)})}},evaluateAllConditions:function(a){function c(){var a=!0;for(var c in d)a&=d[c];return b.log("Checked all conditions",a,d),a}b.log("Try to match all conditions");var d={},e=0;n.each(a.conditions,function(a,c){var f=a+"-"+c.type+"-"+c.value;if(d[f]=!1,"url"===c.type&&-1!==window.location.href.indexOf(c.value)&&(d[f]=!0),"visitor"===c.type){var g=z.checkForRepeatVisitor();"repeat"===c.value&&"true"===c.evaluator||"first"===c.value&&"false"===c.evaluator?g&&(d[f]=!0):g||(d[f]=!0)}if("time"===c.type){var h=Number(c.value);h>e&&(e=h,b.log("Longest time based condition",e)),window.setTimeout(function(){d[f]=!0},6e4*h)}}),0===e?c()&&n(z).trigger(z.EVENTS.PROACTIVE_CONDITION_MATCHED,{trigger:a}):window.setTimeout(function(){c()&&n(z).trigger(z.EVENTS.PROACTIVE_CONDITION_MATCHED,{trigger:a})},6e4*(e+1))},evaluateAnyConditions:function(a){b.log("Checking any conditions"),n.each(a.conditions,function(b,c){if("url"===c.type&&-1!==window.location.href.indexOf(c.value)&&n(z).trigger(z.EVENTS.PROACTIVE_CONDITION_MATCHED,{trigger:a,condition:c}),"visitor"===c.type){var d=z.checkForRepeatVisitor();"repeat"===c.value&&"true"===c.evaluator||"first"===c.value&&"false"===c.evaluator?d&&n(z).trigger(z.EVENTS.PROACTIVE_CONDITION_MATCHED,{trigger:a,condition:c}):d||n(z).trigger(z.EVENTS.PROACTIVE_CONDITION_MATCHED,{trigger:a,condition:c})}"time"===c.type&&window.setTimeout(function(){n(z).trigger(z.EVENTS.PROACTIVE_CONDITION_MATCHED,{trigger:a,condition:c})},6e4*Number(c.value))})},evaluateProactiveChatConditions:function(){n.each(z.proactiveConditions,function(a,c){var d="or"===c.conjunction;d?z.evaluateAnyConditions(c):"and"===c.conjunction?z.evaluateAllConditions(c):b.log("Unknown trigger condition")})},saveCurrentUserInfo:function(){var b=window.hfcStore;b&&(b.setItem("hfc-embed-token",a.EMBED_TOKEN),b.setItem("hfc-name",this.currentUser.name),b.setItem("hfc-email",this.currentUser.email),b.setItem("hfc-access-token",this.currentUser.accessToken),b.setItem("hfc-visitor-id",this.currentUser.visitorId),b.setItem("hfc-last-updated",(new Date).toUTCString()))},setEngageChatEnded:function(a){Boolean(this.currentUser.engageChatEnded)!==a&&(this.currentUser.engageChatEnded=a)},updateCurrentUserState:function(a){this.currentUser.active=a,this.currentUser.active===!1?(this.currentUser.readNotificationCount=0,z.currentUser.isEngageChat&&this.setEngageChatEnded(!0)):this.setEngageChatEnded(!1),n(z).trigger(z.EVENTS.STATE_CHANGED,{state:a});var b=window.hfcStore;b&&(b.setItem("hfc-last-updated",(new Date).toUTCString()),b.setItem("hfc-active",a))},resetCurrentUser:function(){this.resetStoreValues()},resetStoreValues:function(){var a=window.hfcStore;a&&(a.setItem("hfc-embed-token",""),a.setItem("hfc-name",""),a.setItem("hfc-email",""),a.setItem("hfc-access-token",""),a.setItem("hfc-last-updated",""),a.setItem("hfc-active",""),a.setItem("hfc-visitor-id",""),a.setItem("hfc-state",""),a.setItem("hfc-engage-request",""))},cleanValue:function(a){return a&&"null"!==a&&"undefined"!==a?a:""},initUserFromStore:function(){var a=window.hfcStore;if(a){this.currentUser||(this.currentUser={});var b=a.getItem("hfc-state");this.setState(b?b:this.STATES.PASSIVE),this.checkForConversationTimeout(),this.currentUser.name=this.cleanValue(a.getItem("hfc-name")),this.currentUser.email=this.cleanValue(a.getItem("hfc-email")),this.currentUser.accessToken=this.cleanValue(a.getItem("hfc-access-token")),this.currentUser.visitorId=this.cleanValue(a.getItem("hfc-visitor-id")),this.setIsEngageChat("true"===this.cleanValue(a.getItem("hfc-isEngageChat")))}},checkForConversationTimeout:function(){var a=hfcStore.getItem("hfc-chatApiNotifLoopTimestamp"),b=new Date(a),c=new Date,d=hfcStore.getItem("hfc-active"),e=c.getTime()-b.getTime();d&&(!b||e>this.CONVERSATION_TIMEOUT)&&(hfcStore.setItem("hfc-active",!1),this.setState(this.STATES.PASSIVE))},setIsEngageChat:function(a){"boolean"==typeof a&&(this.currentUser.isEngageChat=a,hfcStore.setItem("hfc-isEngageChat",a))},updateChatAPINotifLoopTimestamp:function(){hfcStore.setItem("hfc-chatApiNotifLoopTimestamp",(new Date).toUTCString())},updateVisitorInfo:function(){if(this.currentUser&&this.currentUser.visitorId){var b=window.$hfchatFrame[0].contentWindow;b.postMessage(JSON.stringify({event:"hfc-updateVisitorInfo",data:JSON.stringify(q.fetchData())}),a.HOST_URL)}},checkForExistingUser:function(){var a=window.hfcStore;if(z.iframeReadyDeferred=n.Deferred(),!a)return!1;var c=a.getItem("hfc-last-updated"),d=new Date,e=new Date(c);return d-e<=z.VISITOR_ACTIVE_TIMEOUT?(z.initUserFromStore(),"undefined"==z.currentUser.accessToken?(b.log("Invalid access token"),z.resetCurrentUser(),!1):!0):(b.log("Current entry too old. Resetting user."),b.log(d,e,z.VISITOR_ACTIVE_TIMEOUT,d-e),this.setState(this.STATES.PASSIVE),z.resetCurrentUser(),!1)},_getCurrentAgent:function(){var a=null,b=0;for(var c in z.currentAgents)if(z.currentAgents.hasOwnProperty(c)){var d=z.currentAgents[c];(!a||d.joinedAt>b)&&(a=d,a.id=c,b=d.joinedAt)}return a},getCurrentAgent:function(){var a=this._getCurrentAgent();return a?a.name:""},getCurrentAgentId:function(){var a=this._getCurrentAgent();return a?a.id:null},getAgentDisplayImage:function(b){b||(b=z.getCurrentAgentId());var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-getAgentDisplayImage",data:{agent_id:b},replyEvent:"hfc-receivedAgentDisplayImage"}),a.HOST_URL)},registeredVisitor:function(){q.reset(),z.saveCurrentUserInfo(),z.currentUser.active=!0,n(z).trigger(z.EVENTS.REGISTERED,{name:z.currentUser.name,email:z.currentUser.email,stats:q.getTrackingInfo()})},registerVisitor:function(b,c,d){var e=window.$hfchatFrame[0].contentWindow;z.currentUser.name=b,z.currentUser.email=c,z.currentUser.firstMessage=d;var f={};f["visitor.name"]=z.currentUser.name,f["visitor.email"]=z.currentUser.email,z.setInfo(f),e.postMessage(JSON.stringify({event:"hfc-registerVisitor",data:{name:b,email:c},replyEvent:"hfc-registeredVisitor"}),a.HOST_URL)},getIntegrationInfo:function(b,c){var d=!1;for(var e in z.integrationInfo)if("mailchimp"===z.integrationInfo[e].name){d=!0;break}if(d){var f=window.$hfchatFrame[0].contentWindow;f.postMessage(JSON.stringify({event:"hfc-fetchVisitorIntegrationInfo",data:{name:b,email:c},replyEvent:"hfc-fetchedVisitorIntegrationInfo"}),a.HOST_URL)}},postIntegrationData:function(b,c){var d=window.$hfchatFrame[0].contentWindow;d.postMessage(JSON.stringify({event:"hfc-postIntegrationData",data:{integrationName:b,integrationData:c}}),a.HOST_URL)},submitRatings:function(b){var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-postRating",data:b}),a.HOST_URL)},newSessionAvailable:function(a,c){a?b.log("Problem getting new session"):(z.readNotificationCount=0,z.updateNotificationCount(),z.currentUser.returningVisitor=!0,z.updateCurrentUserState(!0),n(z).trigger(z.EVENTS.SESSION_CREATED,c))},getNewSession:function(b){if(!this.currentUser&&!this.currentUser.accessToken)return void(b&&b(!0));var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-newSession",data:{accessToken:this.currentUser.accessToken},replyEvent:"hfc-newSessionAvailable"}),a.HOST_URL)},sendOfflineMessage:function(b){var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-sendOfflineMessage",data:b,replyEvent:"hfc-offlineMessageSent"}),a.HOST_URL)},sendTranscriptEmail:function(b){b||(b=z.currentUser.email);var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-sendTranscriptEmail",data:{email:b}}),a.HOST_URL)},requestPermissionForNotifications:function(){"Notification"in window&&window.Notification.requestPermission(function(a){"permission"in window.Notification||(window.Notification.permission=a)})},showNotification:function(b,c){if("Notification"in window)if("granted"===window.Notification.permission){new window.Notification(b,{body:c,icon:a.ASSETS_URL+"/images/happyfox.png"})}else"denied"!==window.Notification.permission&&window.Notification.requestPermission(function(d){if("permission"in window.Notification||(window.Notification.permission=d),"granted"===d){new window.Notification(b,{body:c,icon:a.ASSETS_URL+"/images/happyfox.png"})}})},typingStatusUpdated:function(){b.log("Setting typing status"),window.setTimeout(function(){b.log("Resetting typing status"),A.visitorTypingStatus.isTyping=!1},z.VISITOR_TYPING_TIMEOUT)},updateTypingStatus:function(){var b=window.$hfchatFrame[0].contentWindow;b.postMessage(JSON.stringify({event:"hfc-updateTypingStatus",replyEvent:"hfc-typingStatusUpdated"}),a.HOST_URL)},visitorMessageAdded:function(a){n(z).trigger(z.EVENTS.MESSAGE_SENT,{id:a})},deactivateVisitor:function(){var b=window.$hfchatFrame[0].contentWindow;b.postMessage(JSON.stringify({event:"hfc-deactivateVisitor",replyEvent:"hfc-visitorDeactivated"}),a.HOST_URL),this.endEngageChat(),this.setState(this.STATES.PASSIVE)},setupNotifications:function(){var b=window.$hfchatFrame[0].contentWindow;b.postMessage(JSON.stringify({event:"hfc-setupNotifications"}),a.HOST_URL)},handleNotifications:function(a){n(z).trigger(z.EVENTS.NOTIFICATIONS_RECEIVED,{notifications:a})},updateNotificationCount:function(){var b=window.$hfchatFrame[0].contentWindow;b.postMessage(JSON.stringify({event:"hfc-updateNotificationCount",data:{notificationCount:z.readNotificationCount}}),a.HOST_URL)},addVisitorMessage:function(b,c,d){z.updateCurrentUserState(!0);var e=window.$hfchatFrame[0].contentWindow;e.postMessage(JSON.stringify({event:"hfc-addVisitorMessage",data:{message:{id:d,text:b}},replyEvent:"hfc-visitorMessageAdded"}),a.HOST_URL)},addMetadata:function(b){var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-addMetadata",data:{metadata:b},replyEvent:"hfc-addMetadata-reply"}),a.HOST_URL)},setInfo:function(b){var c=window.$hfchatFrame[0].contentWindow;b=n.extend(this.getInfo(),b),hfcStore.setItem("hfc-visitorinfo-properties",JSON.stringify(b)),z.iframeReadyDeferred.done(function(){c.postMessage(JSON.stringify({event:"hfc-setInfo",data:{properties:b},replyEvent:"hfc-setInfo-reply"}),a.HOST_URL)})},getInfo:function(){var a=hfcStore.getItem("hfc-visitorinfo-properties"),c={};if(a)try{c=JSON.parse(a)}catch(d){b.error("Exception while parsing the visitor info from localstorage. Error:",d,"String:",a)}return c},setEngageRequest:function(c,d){if(d||(d={}),c){if(hfcStore.setItem("hfc-engage-request",JSON.stringify(c)),this.currentUser||(this.currentUser={}),this.currentUser.engageRequest=c,this.setInfo({"user.is_engaged":!0,"user.agent_chat_id":c.message.chatAgentId}),this.setEngageChatEnded(!1),this.currentAgents[c.message.chatAgentId]={name:this.currentUser.engageRequest.message.agentName,joinedAt:(new Date).getTime()},A.setAgentDisplayImage({result:{profile_url:this.currentUser.engageRequest.message.agentDPUrl}}),this.currentUser.engageRequest&&"pending"===this.currentUser.engageRequest.status){var e=this.currentUser.engageRequest.message.text[this.currentUser.engageRequest.message.text.length-1];A.showProactiveNotification(this.currentUser.engageRequest),A.activateVisitor(),d.addMessages&&A.addEngageMessages(this.currentUser.engageRequest.message.text),d.addRecentMessage&&A.addEngageMessage(e),A.hideRegistrationForm=!0}if(this.currentUser.engageRequest&&"pending"===this.currentUser.engageRequest.status){var f=1e3,g=60*f,h=60*g,i=new Date,j=0,k=this.currentUser.engageRequest.message.createdAt,l=i.getTime()-parseInt(k);h>l&&(j=h-l),b.info("Setting timeout for dropping the request. Timeout Value:",parseInt(j/6e4),"minutes"),z.engageRequestDropTimeout=window.setTimeout(function(){b.info("Dropping the engage request since the visitor did not respond for more than 1 hour"),z.endEngageChat()},j)}var m=window.$hfchatFrame[0].contentWindow;m.postMessage(JSON.stringify({event:"hfc-setEngageRequest",data:c,replyEvent:"hfc-setEngageRequest-reply"}),a.HOST_URL)}},acceptEngageRequest:function(){return this.currentUser.engageRequest?(this.currentUser.engageRequest.status="accepted",this.setInfo({"user.is_engaged":!1,"user.is_engage_chat":!0}),A.hideProactiveNotification(),hfcStore.setItem("hfc-engage-request",JSON.stringify(this.currentUser.engageRequest)),this.setIsEngageChat(!0),window.clearTimeout(z.engageRequestDropTimeout),!0):!1},endEngageChat:function(){return this.currentUser.engageRequest?(this.unsetEngageRequest(),this.setIsEngageChat(!1),this.setInfo({"user.is_engaged":!1,"user.is_engage_chat":!1,"user.agent_chat_id":!1}),window.clearTimeout(z.engageRequestDropTimeout),!0):!1},unsetEngageRequest:function(){if(this.currentUser.engageRequest){hfcStore.removeItem("hfc-engage-request"),delete this.currentUser.engageRequest,A.hideProactiveNotification(),window.clearTimeout(z.engageRequestDropTimeout);var b=window.$hfchatFrame[0].contentWindow;b.postMessage(JSON.stringify({event:"hfc-unsetEngageRequest",replyEvent:"hfc-unsetEngageRequest-reply"}),a.HOST_URL)}},validateEngageRequest:function(a){var c=hfcStore.getItem("hfc-engage-request");if("string"==typeof c&&"undefined"!==c&&""!==c){try{this.currentUser.engageRequest=JSON.parse(c)}catch(d){b.error("Caught error when restoring engageRequest object from localStore",d.message,d)}if(this.currentUser.engageRequest){var e=1e3,f=60*e,g=60*f,h=new Date,i=new Date(this.currentUser.engageRequest.message.createdAt),j=h.getTime()-i.getTime();g>j?this.setEngageRequest(z.currentUser.engageRequest,a):this.unsetEngageRequest()}else this.unsetEngageRequest()}else this.unsetEngageRequest()},handleAgentEngageRequest:function(a){z.currentUser.active?this.rejectAgentEngageRequest(a.agent_id):this.currentUser.engageRequest?this.currentUser.engageRequest.message.chatAgentId===a.message.chatAgentId?(this.currentUser.engageRequest.message.text=[this.getEngageText(a)],this.currentUser.engageRequest.status="pending",this.currentUser.engageRequest.message.updatedAt=a.message.createdAt,this.setEngageRequest(this.currentUser.engageRequest,{addRecentMessage:!0}),A.hideChatAgainView()):this.rejectAgentEngageRequest(a.agent_id):(a.message.text=[this.getEngageText(a)],a.status="pending",this.setEngageRequest(a,{addMessages:!0}),A.hideChatAgainView())},getEngageText:function(a){return{message:a.message.text,createdAt:a.message.createdAt,agentId:a.message.chatAgentId,name:a.message.agentName}},rejectAgentEngageRequest:function(b){var c=window.$hfchatFrame[0].contentWindow;c.postMessage(JSON.stringify({event:"hfc-rejectEngageRequest",data:{agentId:b},replyEvent:"hfc-rejectEngageRequest-reply"}),a.HOST_URL)},Random:{s4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return this.s4()+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+"-"+this.s4()+this.s4()+this.s4()}}},A=window.HFLiveChatView={MESSAGES:{HEADER:{MINIMIZED_ONLINE_MESSAGE:"Chat with us!",MINIMIZED_OFFLINE_MESSAGE:"Leave us a message!",MAXIMIZED_ONLINE_MESSAGE:"Live Chat"},INFO_PAGE:{WELCOME_GREETING:"Hey there!",WELCOME_TEXT:"Please help us get started with some basic information about yourself. We'll have one of our staff assisting you in no time.",START_BUTTON_TEXT:"Start Chat"},CONVERSATION_PAGE:{WELCOME_INFO_TEXT:"Hi {visitorName}, we have received your request. One of our agents will assist you shortly (Usually within 30 seconds).",FIRST_AUTO_MESSAGE:"Hi {visitorName}, How can we help you today?",AGENT_JOINED_INFO_TEXT:"You are now talking to {agentName}, our customer support agent.",CHAT_ENDED_INFO_TEXT:"This conversation has ended.",COMPANY_GREETING:"Welcome!",COMPANY_GREETING_SUBTITLE:"Live Chat",AGENT_DESIGNATION:"Customer Support Agent"},END_CONVERSATION_PAGE:{CONFIRMATION_TEXT:"This will end this chat session. Do you really want to leave this conversation?"},OFFLINE_PAGE:{INFO_TEXT:"Sorry, we are away. Leave us a message and we'll get back to you."},SUBSCRIBE_NEWSLETTER_PAGE:{SUBSCRIPTION_REQUEST_TEXT:"Would you like to join our mailing list-2?"}},URL_REGEX:/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2}))|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/i,EVENTS:{INIT:"init"},processTemplate:function(a,b){var c=a;return n.each(b,function(b,d){var e=new RegExp("{s*"+b+"s*}");if(e.test(a)){"undefined"===d&&(d="");var f='<span class="hfc-'+b+'">'+d+"</span>";c=c.replace(e,f)}}),c},linkifyMessage:function(a){var b="";return n.each(a.split(" "),function(a,c){var d=c.match(A.URL_REGEX),e="";d?(/^https?:\/\//i.test(d[0])||(e="http://"),b+="<a href='"+e+d[0]+"' class='linkified' target='_blank'>"+d[0]+"</a>"):b+=n("<div></div>").text(c).html(),b+=" "}),b},init:function(b){if(!this.initialized){this.$container=n(".hfc-chat-container"),this.$conversationContainer=this.$container.find(".hfc-conversation"),this.$minimizedViewContainer=this.$container.find(".hfc-default-minimized-view"),this.$mobileBadge=this.$container.find(".hfc-default-minimized-view-mobile"),this.$chatWindow=this.$container.find(".hfc-chat-window"),this.$chatWindowBody=this.$chatWindow.find(".hfc-body-container"),this.$chatWindowBackgroundContainer=this.$chatWindowBody.find(".hfc-background-container"),this.$chatWindowTitleBar=this.$container.find(".hfc-title-bar"),this.$chatWindowTitle=this.$chatWindowTitleBar.find(".hfc-title-text"),this.$userInfoViewContainer=this.$container.find(".hfc-initial-info"),this.$conversationView=this.$container.find(".hfc-conversation-view"),this.$endConversationView=this.$container.find(".hfc-end-conversation-dialog"),this.$offlineView=this.$container.find(".hfc-offline-view"),this.$offlineResultView=this.$container.find(".hfc-offline-msg-result-page"),this.$startButton=this.$container.find(".hfc-start"),this.$offlineButton=this.$container.find(".hfc-send-offline-msg"),this.$endButton=this.$container.find(".hfc-confirm.leave"),this.$sendButton=this.$container.find(".hfc-send"),this.$dropDown=this.$container.find(".hfc-dropdown"),this.$overlay=this.$container.find(".hfc-overlay"),this.$startNewConversation=this.$container.find(".hfc-return-container"),this.$emailSuccessIconContainer=this.$container.find(".hfc-success-icon"),this.$dismissLink=this.$container.find(".hfc-dismiss-link"),this.$optionsDialog=this.$container.find(".hfc-options-dialog"),this.$optionsDrawer=this.$optionsDialog.find(".hfc-options-drawer"),
this.$optionsMenu=this.$optionsDrawer.find(".hfc-options-menu"),this.$emailTranscriptView=this.$container.find(".hfc-email-container"),this.$emailConfirmationView=this.$container.find(".hfc-email-confirmation"),this.$muteContainer=this.$container.find(".hfc-mute-icon"),this.$menuIcon=this.$chatWindowTitleBar.find(".hfc-title-icon"),this.$pushMenu=this.$conversationView.find(".hfc-push-menu"),this.$conversationEndedContainer=this.$container.find(".hfc-chat-ended-dialog"),this.$conversationOverlay=this.$conversationView.find(".hfc-conversation-overlay"),this.$hfcNewsletterSubscribe=this.$container.find(".hfc-newsletter-subscribe"),this.$hfcNewsletterSubscribeButton=this.$container.find("#hfc-newsletter-subscribe-button"),this.$hfcSkipSubscription=this.$hfcNewsletterSubscribe.find("#hfc-skip-subscription"),this.$hfcSubscribeVisitorEmailInput=this.$container.find("#hfc-subscribe-visitor-email-input"),this.$hfcNewsletterSubscriptionConfirmation=this.$container.find(".hfc-newsletter-subscription-confirmation"),this.$hfcSubscriptionRequestText=this.$container.find("#hfc-subscription-request-text"),this.$proactiveNotification=this.$minimizedViewContainer.find(".hfc-proactive-notification"),this.$proactiveNotificationMobile=this.$mobileBadge.find(".hfc-proactive-notification"),this.$hfcCustomTextColor=this.$container.find(".hfc-custom-text-color"),this.$hfcRatingsCt=this.$container.find(".hfc-agent-ratings-ct"),this.$hfcRatingStar=this.$hfcRatingsCt.find(".hfc-star"),this.$hfcRatingSubmitButton=this.$hfcRatingsCt.find("#hfc-rating-submit"),this.$hfcSkipRatingButton=this.$hfcRatingsCt.find("#hfc-skip-rating"),this.$hfcRatingConfirmation=this.$container.find(".hfc-rating-confirmation"),this.$hfcRatingsCurrentAgent=this.$hfcRatingsCt.find(".hfc-agent-name"),this.$hfcRatingFeedbackCt=this.$container.find(".hfc-rating-feedback-ct"),this.$hfcRatingFeedbackTextbox=this.$container.find(".hfc-rating-feedback-textbox"),this.pushMenuOpen=!1,this.actionsMenuOpen=!1,this.minimizeTimer=!1,this.hideEmailSuccess,this.showingEmailSuccess=!1,this.skipSubscription=!1,this.skipRating=!1,this.currentRating=null,this.visitorTypingStatus={isTyping:!1,lastUpdated:null},this.agentsOffline=!1,this.hfcStore=window.hfcStore,this.playSound=!0,this.hfcStore&&(this.playSound="false"!==this.hfcStore.getItem("hfc-view-playSound")),this.focusInput=!0,this.allowMinimize=!0,this.mobileMode=!1,this.options=b.data.widget;for(var c=b.data.widget,d=b.data.apps,e={},f=0,g=d.length;g-1>=f;f++)if("mailchimp"===d[f].name){e[d[f].name]=d[f];break}b&&c&&(this.customizeAppearance(c.appearance),this.maximizedOnLoad=c.maximizedOnLoad,this.appearance=c.appearance);var h={HEADER:{MINIMIZED_ONLINE_MESSAGE:c.text.badge,MINIMIZED_OFFLINE_MESSAGE:c.text.offlineBadge,MAXIMIZED_ONLINE_MESSAGE:c.text.titleBar},INFO_PAGE:{WELCOME_GREETING:c.text.welcomeTextTitle,WELCOME_TEXT:c.text.welcomeText,START_BUTTON_TEXT:c.text.startButton},CONVERSATION_PAGE:{FIRST_AUTO_MESSAGE:c.text.firstMessage,COMPANY_GREETING:c.text.companyGreeting,COMPANY_GREETING_SUBTITLE:c.text.companyGreetingSubtitle},OFFLINE_PAGE:{INFO_TEXT:c.text.offlineWelcomeText},SUBSCRIBE_NEWSLETTER_PAGE:{SUBSCRIPTION_REQUEST_TEXT:e.mailchimp?e.mailchimp.settings.subscriptionRequestText:""}};this.messages=n.extend(!0,A.MESSAGES,h),c.hasOwnProperty("hideRegistrationForm")&&(this.hideRegistrationForm=c.hideRegistrationForm),this.setupUIEvents(),this.initialized=!0,this.defaultPageTitle=document.title,a.overrides&&(this.maximizedOnLoad=a.overrides.maximizedOnLoad,this.focusInput=a.overrides.focusInput,this.allowMinimize=a.overrides.allowMinimize,this.mobileMode=a.overrides.mobileMode)}},customizeAppearance:function(b){this.primaryColor=b.primaryColor,this.secondaryColor=b.secondaryColor,this.darkerPrimaryColor=this.colorLuminance(this.primaryColor,-.2),this.theme=b.theme,this.position=b.position,this.lighterPrimaryColor=this.colorLuminance(this.primaryColor,.2),this.primaryColorRGB=this.hexToRgb(this.primaryColor),this.lighterPrimaryColorOpacity="rgba("+this.primaryColorRGB.r+","+this.primaryColorRGB.g+","+this.primaryColorRGB.b+",0.9)",this.$chatWindowTitleBar.css({"background-color":"#"+this.primaryColor}),this.$chatWindowBody.css({"background-color":"#fff"}),this.$chatWindowBackgroundContainer.css({"background-color":this.lighterPrimaryColorOpacity}),this.$conversationView.find(".hfc-send").css({color:"#"+this.primaryColor}),this.$minimizedViewContainer.css({"background-color":"#"+this.primaryColor}),this.$startNewConversation.find(".hfc-new-conversation").css({"background-color":"#"+this.primaryColor}),this.$chatWindowTitleBar.find(".hfc-title").css({color:"#"+this.secondaryColor}),this.$minimizedViewContainer.find(".hfc-badge-title").css({color:"#"+this.secondaryColor}),this.$overlay.css({"background-color":"rgba(0,0,0,0.8)"}),this.$conversationOverlay.css({"background-color":"rgba(0,0,0,0.8)"}),("right"===this.position||"left"===this.position)&&("000000"===this.secondaryColor?n("#hfc-badge-icon").attr("src",a.ASSETS_URL+"/images/chat-bubble-round-dark.png"):n("#hfc-badge-icon").attr("src",a.ASSETS_URL+"/images/chat-bubble-round.png")),"right"===this.position&&(this.$container.addClass("hfc-vertical-middle"),this.$minimizedViewContainer.removeClass("hfc-badge-bottom").addClass("hfc-badge-right"),this.$proactiveNotification.addClass("hfc-bubble-right")),"left"===this.position&&(this.$container.addClass("hfc-vertical-middle hfc-pos-left"),this.$minimizedViewContainer.removeClass("hfc-badge-bottom").addClass("hfc-badge-left"),this.$proactiveNotification.addClass("hfc-bubble-left")),"000000"===this.secondaryColor&&(this.$chatWindowTitleBar.find(".hfc-title-options").attr({src:a.ASSETS_URL+"/images/widget-dots-menu-dark.png"}),this.$chatWindowBody.find(".hfc-welcome-message").css({color:"#000000"}),this.$chatWindowBody.find(".hfc-offline-message").css({color:"#000000"}),this.$chatWindowBody.find(".hfc-material-input label").css({color:"#000000"}),this.$chatWindowBody.find(".hfc-material-input input").css({color:"#000000"}),this.$chatWindowBody.find(".hfc-material-input textarea").css({color:"#000000"}),this.$container.find(".hfc-typing-indicator").css({color:"#000000"}),this.$chatWindowBody.find(".hfc-material-input input").css({"border-color":"#000000"}),this.$chatWindowBody.find(".hfc-material-input textarea").css({"border-color":"#000000"}),this.$chatWindowBody.find(".hfc-material-input .bar").css({"background-color":"#000000"}),this.$emailTranscriptView.find(".hfc-material-input label").css({color:"#ffffff"}),this.$emailTranscriptView.find(".hfc-material-input input").css({color:"#ffffff","border-color":"#fff"}),this.$emailTranscriptView.find(".hfc-material-input .bar").css({"background-color":"#ffffff"}),this.$container.find(".hfc-email-transcript").css({color:"#000000"}),this.$container.find(".hfc-chat-ended-label").css({color:"#000000"}),this.$overlay.css({"background-color":"rgba(0,0,0,0.8)"}),this.$conversationOverlay.css({"background-color":"rgba(0,0,0,0.8)"}),this.$container.find(".hfc-return-to-website").css({color:"#000000"}),this.$hfcNewsletterSubscribe.css("color","#000000"),this.$hfcNewsletterSubscriptionConfirmation.css("color","#000000"),this.$hfcCustomTextColor.css("color","#000000"))},applySpeechBubbleTheme:function(){this.primaryColorRGB=this.hexToRgb(this.primaryColor),this.lighterPrimaryColor="rgba("+this.primaryColorRGB.r+","+this.primaryColorRGB.g+","+this.primaryColorRGB.b+",0.3)",this.$conversationView.find(".hfc-quote-container.visitor").css({"background-color":this.lighterPrimaryColor}),this.$conversationView.find(".hfc-quote-container.visitor").css({color:this.lighterPrimaryColor}),this.$conversationView.find(".hfc-quote-container.visitor").css({"border-color":this.lighterPrimaryColor})},colorLuminance:function(a,b){for(a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0,this.rgb="#",this.i=0;this.i<3;this.i++)this.colorVal=parseInt(a.substr(2*this.i,2),16),this.colorVal=Math.round(Math.min(Math.max(0,this.colorVal+this.colorVal*b),255)).toString(16),this.rgb+=("00"+this.colorVal).substr(this.colorVal.length);return this.rgb},hexToRgb:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},validateName:function(a){var b=a;a||(b=A.$userInfoViewContainer.find(".hfc-form"));var c=b.find("input[name='name']"),d=b.find(".hfc-validate-name"),e=n.trim(c.val());return e?(c.removeClass("error"),d.hide(),!0):(c.addClass("error"),d.show(),!1)},validateEmail:function(a){var b=a;a||(b=A.$userInfoViewContainer.find(".hfc-form"));var c=b.find("input[name='email']"),d=b.find(".hfc-validate-email"),e=n.trim(c.val()),g=f(e);return e&&g?(c.removeClass("error"),d.hide(),!0):(c.addClass("error"),d.show(),!1)},validateMessage:function(a){var b=a;a||(b=A.$userInfoViewContainer.find(".hfc-form"));var c=b.find("textarea[name='message']"),d=n.trim(c.val()),e=b.find(".hfc-validate-message");return d?(c.removeClass("error"),e.hide(),!0):(c.addClass("error"),e.show(),!1)},validateFields:function(a){var b=a;a||(b=A.$userInfoViewContainer.find(".hfc-form"));var c=b.find("input[name='name']"),d=n.trim(c.val()),e=b.find("input[name='email']"),f=n.trim(e.val()),g=b.find("textarea[name='message']"),h=A.validateName(b),i=A.validateEmail(b),j=!(h&&i),k="";return g.length&&(j&=this.validateMessage(b),k=n.trim(g.val())),j?!1:{name:d,email:f,message:k}},getTimestamp:function(a){a||(a=new Date);var b="am",c=a.getHours(),d=a.getMinutes();c>12?(c-=12,b="pm"):(12===c&&(b="pm"),0===c&&(c=12)),10>d&&(d="0"+d);var e=c+":"+d+" "+b;return e},checkIfCSSIsLoaded:function(){for(var b=a.ASSETS_URL+"/styles/embed.css",c=document.styleSheets,d=0,e=c.length;e>d;d++)if(c[d].href==b)return!0;return!1},updateUnreadNotificationCount:function(){var a=A.$chatWindowBody.is(":hidden");a&&(n.isNumeric(parseFloat(z.currentUser.unreadNotificationCount))?z.currentUser.unreadNotificationCount=1:z.currentUser.unreadNotificationCount+=1,this.$minimizedViewContainer.find(".hfc-unread").show().text(z.currentUser.unreadNotificationCount))},showMinimizedChatWindow:function(){this.$currentView=this.$minimizedViewContainer,this.setWidgetPos(this.position,"minimize"),this.$chatWindow.hide(),A.hideDialogs(),this.$minimizedViewContainer.show(),this.renderBadgeTitle(),z.currentUser.unreadNotificationCount&&this.$minimizedViewContainer.find(".hfc-unread").show()},renderBadgeTitle:function(){var a=A.agentsOffline?A.messages.HEADER.MINIMIZED_OFFLINE_MESSAGE:A.messages.HEADER.MINIMIZED_ONLINE_MESSAGE;this.$minimizedViewContainer.find(".hfc-badge-title").text(a);var b=z.getCurrentAgent();return z.currentUser.engageRequest?(this.$minimizedViewContainer.find(".hfc-badge-title").text(z.currentUser.engageRequest.message.agentName),void n(".hfc-title-text").text(z.currentUser.engageRequest.message.agentName)):(b&&this.$minimizedViewContainer.find(".hfc-badge-title").text(b),void(z.currentUser.active||this.$minimizedViewContainer.find(".hfc-badge-title").text(a)))},restoreChatWindow:function(){this.$chatWindow.show(),this.$minimizedViewContainer.hide(),this.$minimizedViewContainer.find(".hfc-unread").hide(),z.currentUser.active||(this.$optionsDrawer.find(".hfc-close").hide(),z.currentUser.deactivated?A.$chatWindowTitleBar.find(".hfc-chat-ended-label").show():A.$chatWindowTitleBar.find(".hfc-chat-ended-label").hide(),this.$conversationView.find(".hfc-end-conversation").hide(),this.$conversationView.find(".hfc-is-typing-status").hide()),A.agentsOffline?this.$endConversationView.find(".hfc-ended-action").hide():this.$endConversationView.find(".hfc-ended-action").show()},showMinimizedView:function(){var a=z.getCurrentAgent();return a?void this.showMinimizedChatWindow():(this.$currentView=this.$minimizedViewContainer,this.$chatWindow.hide(),this.renderBadgeTitle(),void this.$minimizedViewContainer.show())},showProactiveNotification:function(a){var b=a.message.text[a.message.text.length-1];this.showProactiveBubble(b.message),a.message.agentDPUrl&&n(".hfc-badge-icon").attr("src",a.message.agentDPUrl)},showProactiveBubble:function(a){"string"==typeof a&&A.setProactiveMessage(a),A.$proactiveNotification.off("transitionend webkitTransitionEnd oTransitionEnd"),A.$proactiveNotification.addClass("hfc-hidden-animation-state"),A.$proactiveNotification.show(),A.$proactiveNotificationMobile.off("transitionend webkitTransitionEnd oTransitionEnd"),A.$proactiveNotificationMobile.addClass("hfc-hidden-animation-state"),A.$proactiveNotificationMobile.show(),setTimeout(function(){A.$proactiveNotification.removeClass("hfc-hidden-animation-state"),A.$proactiveNotificationMobile.removeClass("hfc-hidden-animation-state")})},hideProactiveNotification:function(){A.$proactiveNotification.addClass("hfc-hidden-animation-state"),A.$proactiveNotificationMobile.addClass("hfc-hidden-animation-state"),A.$proactiveNotification.on("transitionend webkitTransitionEnd oTransitionEnd",function(){A.$proactiveNotification.hide(),A.$proactiveNotification.removeClass("hfc-hidden-animation-state")}),A.$proactiveNotificationMobile.on("transitionend webkitTransitionEnd oTransitionEnd",function(){A.$proactiveNotificationMobile.hide(),A.$proactiveNotificationMobile.removeClass("hfc-hidden-animation-state")}),z.currentUser.engageRequest||this.removeAgentDisplayImage(),this.renderBadgeTitle()},setProactiveMessage:function(a){var b=z.plainTextProcessor.process(a);A.$minimizedViewContainer.find(".hfc-proactive-message").html(b),A.$mobileBadge.find(".hfc-proactive-message").html(b)},addEngageMessages:function(a){for(var b=a.length,c=0;b>c;c++){var d=a[c];this.addEngageMessage(d)}},addEngageMessage:function(a){var b=z.plainTextProcessor.process(a.message);A.addAgentMessage(a.name,b,a.createdAt,!0,!0)},showUserInfoFormView:function(){if(this.formShown=!0,A.setWidgetPos(A.position,"maximize"),A.$container.find(".hfc-typing-indicator").hide(),A.$chatWindowTitleBar.find(".hfc-chat-ended-label").hide(),this.$chatWindowTitle.text(A.messages.HEADER.MAXIMIZED_ONLINE_MESSAGE),A.agentsOffline&&(!z.currentUser.engageRequest||"pending"!==z.currentUser.engageRequest.status)&&"chatting"!==z.state)return void A.showOfflineView();if(z.currentUser.name&&"undefined"!==z.currentUser.name&&z.currentUser.email&&"undefined"!==z.currentUser.email||A.hideRegistrationForm)return z.currentUser.newConversation&&!z.currentUser.engageRequest&&this.showAutoMessage(),A.showConversationView(),void(z.currentUser.engageRequest&&"pending"===z.currentUser.engageRequest.status&&A.hideChatAgainView());if(z.currentUser.engageRequest&&"pending"===z.currentUser.engageRequest.status||z.currentUser.isEngageChat)return A.showConversationView(),void A.hideChatAgainView();this.$currentView=this.$userInfoViewContainer,z.currentUser.unreadNotificationCount=0,this.$minimizedViewContainer.find(".hfc-unread").hide(),this.$minimizedViewContainer.hide(),this.$container.find(".hfc-page").hide();var a=this.$userInfoViewContainer.find(".hfc-form");a.find('input[name="name"]').val(""),a.find('input[name="email"]').val(""),a.find("textarea[name='message']").val(""),this.$userInfoViewContainer.find(".hfc-welcome-message").text(A.messages.INFO_PAGE.WELCOME_TEXT),this.$startButton.find(".hfc-start-text").text(A.messages.INFO_PAGE.START_BUTTON_TEXT),this.$userInfoViewContainer.show(),this.$chatWindowBody.show(),this.$chatWindow.show(),A.focusInput&&a.find('input[name="name"]').focus()},showOfflineBanner:function(){A.$startButton.attr("disabled","disabled").css("background","rgb(121, 121, 121)"),A.$conversationView.find(".hfc-message").attr("disabled","disabled").css("background","#F9F1C2").attr("placeholder","Connecting..."),A.$sendButton.css("pointer-events","none"),A.$container.find(".hfc-offline-banner").show().animate("margin-top","0");var a=A.$container.find(".hfc-agent-ratings-ct");"none"!==a.css("display")&&A.$container.find(".hfc-overlay-chatbody").show(),A.offlineBannerVisible=!0},clearOfflineBanner:function(){A.offlineBannerVisible&&(A.$startButton.removeAttr("disabled").css({"background-color":"#"+this.primaryColor}),A.$container.find(".hfc-offline-banner").hide(),A.$conversationView.find(".hfc-message").css("background","#FFF"),A.$container.find(".hfc-overlay-chatbody").hide(),0===A.$conversationView.find(".hfc-ended-message:visible").length?(A.$conversationView.find(".hfc-message").removeAttr("disabled").attr("placeholder","Type your message here"),A.$sendButton.css("pointer-events","all")):A.$conversationView.find(".hfc-message").attr("placeholder","chat ended."),A.offlineBannerVisible=!1)},showConversationView:function(){this.$currentView=this.$conversationView,A.setWidgetPos(A.position,"maximize"),z.currentUser.unreadNotificationCount=0,this.$minimizedViewContainer.find(".hfc-unread").hide(),this.$container.find(".hfc-page").hide(),this.$chatWindowTitleBar.find(".hfc-title-options").show(),this.$chatWindowBackgroundContainer.css({"background-color":"#fff"}),this.$conversationView.find(".hfc-is-typing-status").show(),this.$conversationView.find(".hfc-conversation-closed").hide(),this.$chatWindowTitleBar.find(".hfc-typing-indicator").hide();var a=A.messages.CONVERSATION_PAGE,b=z.getCurrentAgent();if(z.currentUser){this.processTemplate(a.WELCOME_INFO_TEXT,{visitorName:z.currentUser.name,agentName:b})}if(b){{this.processTemplate(A.messages.CONVERSATION_PAGE.AGENT_JOINED_INFO_TEXT,{agentName:b})}z.getAgentDisplayImage(),A.showAgentDisplayImage(),this.$chatWindowTitle.text(b)}this.updateSoundNotificationOption(),this.$conversationView.show(),this.scrollToBottom(),this.$chatWindowBody.show(),this.$chatWindow.show(),this.$conversationView.find(".hfc-message").expanding(),this.focusInput&&this.$conversationView.find(".hfc-message").focus(),this.$chatWindowTitleBar.find(".hfc-chat-ended-label").hide(),z.currentUser.active||(this.$conversationView.find(".hfc-end-conversation").hide(),z.currentUser.deactivated&&z.currentUser.engageRequest&&"pending"!==z.currentUser.engageRequest.status&&this.$chatWindowTitleBar.find(".hfc-chat-ended-label").show())},showEndConversationView:function(){this.$currentView=this.$endConversationView,this.$endConversationButton=this.$endConversationView.find(".hfc-confirm.leave"),z.currentUser.unreadNotificationCount=0,this.$minimizedViewContainer.find(".hfc-unread").hide(),this.hideOptionsDrawer(),this.$endConversationView.find(".hfc-confirm-leave").text(A.messages.END_CONVERSATION_PAGE.CONFIRMATION_TEXT),this.$endConversationButton.find(".hfc-first-line.hfc-end").text("End Chat"),this.$endConversationView.find(".hfc-end-confirmation").show(),this.$endConversationView.find(".hfc-ended").hide(),this.$endConversationView.animate({"margin-top":"0px"}).show(),this.$overlay.fadeIn(),this.$chatWindowBody.show(),this.$chatWindow.show()},showOfflineView:function(){return A.offlineMessageSent?void A.showOfflineSuccessPage():(this.$currentView=this.$offlineView,this.$minimizedViewContainer.find(".hfc-unread").hide(),this.$container.find(".hfc-page").hide(),A.$container.find(".hfc-typing-indicator").hide(),this.$offlineView.find(".hfc-offline-message").text(A.messages.OFFLINE_PAGE.INFO_TEXT),this.$chatWindowTitle.text(A.messages.HEADER.MAXIMIZED_ONLINE_MESSAGE),this.$conversationEndedContainer.css({"z-index":"-1"}),this.$offlineView.show(),this.$chatWindowBody.show(),this.$chatWindowBackgroundContainer.css({"background-color":this.lighterPrimaryColorOpacity}),void this.$chatWindow.show())},showNewsletterView:function(){A.$endConversationView.hide(),A.$conversationContainer.hide(),A.$hfcRatingsCt.hide(),A.$container.find(".hfc-reply-area").hide(),A.$hfcSubscriptionRequestText.text(A.messages.SUBSCRIBE_NEWSLETTER_PAGE.SUBSCRIPTION_REQUEST_TEXT),A.$hfcSubscribeVisitorEmailInput.val(z.currentUser.email),A.$container.find(".hfc-theme-overlay").show().css({"background-color":A.lighterPrimaryColorOpacity}),A.$hfcNewsletterSubscribe.show(),A.$conversationEndedContainer.css({"margin-bottom":"-150px"})},showRatingFormView:function(){A.hideEmailView(),A.$endConversationView.hide(),A.$conversationContainer.hide(),A.$hfcNewsletterSubscribe.hide(),A.$container.find(".hfc-reply-area").hide(),A.$container.find(".hfc-theme-overlay").show().css({"background-color":A.lighterPrimaryColorOpacity}),A.$hfcRatingsCurrentAgent.html(z.getCurrentAgent()),A.$hfcRatingsCt.show(),A.$conversationEndedContainer.css({"margin-bottom":"-150px"})},showOfflineSuccessPage:function(){this.$currentView=this.$offlineResultView,this.$minimizedViewContainer.find(".hfc-unread").hide(),this.$container.find(".hfc-page").hide(),A.offlineMessageSent=!0,this.$offlineResultView.show(),this.$overlay.show(),this.$chatWindowBody.show(),this.$chatWindow.show()},handleAgentLeaving:function(a){z.currentUser.active!==!1&&(A.addNotification("&mdash; "+z.currentAgents[a].name+" has left the conversation. &mdash;"),delete z.currentAgents[a])},scrollToBottom:function(){h()||this.$conversationContainer.animate({scrollTop:this.$conversationContainer[0].scrollHeight},"slow")},hasVisitorMessages:function(){return this.$conversationContainer.find(".hfc-quote-container.visitor").length>0},addVisitorMessage:function(b,c,d,e){e=e?e:"hfc-delivered";var f='<div class="hfc-quote-container visitor new-quote sending"><div class="hfc-username hfc-left">';f+=z.currentUser.name,f+='</div> <span class="hfc-quote-timestamp hfc-right">',f+=c,f+='</span> <div class="clearfix"></div> <div class="hfc-quote me">',f+=z.plainTextProcessor.process(b),f+='</div> <img class="hfc-loading '+e+'" src="'+a.ASSETS_URL+'/images/dots-white.gif"> </div>',"undefined"==typeof d||d===!0?(this.$conversationContainer.append(f),this.applySpeechBubbleTheme(),this.scrollToBottom(),n(".hfc-quote-timestamp").fadeOut("fast")):(this.$conversationContainer.append(f),this.applySpeechBubbleTheme())},addAgentMessage:function(a,b,c,d,e){var f,g=n("<div/>",{"class":"hfc-quote-container agent new-quote"}),h=n("<div/>",{"class":"hfc-username hfc-left",text:a});g.append(h);var i=n("<span/>",{"class":"hfc-quote-timestamp hfc-right",text:c});g.append(i);var j=n("<div/>",{"class":"clearfix"});g.append(j),f=e===!0?b:z.plainTextProcessor.process(b);var k=n("<div/>",{"class":"hfc-quote",html:f});g.append(k),"undefined"==typeof d||d===!0?(this.$conversationContainer.append(g),this.scrollToBottom()):this.$conversationContainer.append(g),n(".hfc-badge-title").text(a),n(".hfc-quote-timestamp").fadeOut("fast")},updateSoundNotificationOption:function(){A.playSound?(this.$muteContainer.text("Turn off sound"),this.$muteContainer.removeClass("hfc-speaker-on").addClass("hfc-speaker-off")):(this.$muteContainer.text("Turn on sound"),this.$muteContainer.removeClass("hfc-speaker-off").addClass("hfc-speaker-on")),A.hfcStore.setItem("hfc-view-playSound",A.playSound)},addNotification:function(a){var b='<div class="hfc-quote-container message">'+a+"</div>";this.$conversationContainer.append(b),this.scrollToBottom()},playNotificationSound:function(){if(A.playSound)try{n("#hfChatAudio")[0].play()}catch(a){b.log("Error playing sound.")}},activateVisitor:function(){this.$conversationView.find(".hfc-conversation-closed").hide(),this.$conversationView.find(".hfc-is-typing-status").show(),this.$conversationView.find(".hfc-message").removeAttr("disabled").attr("placeholder","Type your message here"),this.$sendButton.css("pointer-events","all"),this.$conversationView.find(".hfc-is-typing-status").show(),this.$optionsDrawer.find(".hfc-close").show(),this.$conversationView.find(".hfc-message").show(),this.$conversationView.find(".hfc-reply-area").show(),this.$startNewConversation.hide(),this.$chatWindowTitleBar.find(".hfc-chat-ended-label").hide()},deactivateVisitor:function(){this.$conversationView.find(".hfc-message").blur(),this.$conversationView.find(".hfc-message").attr("disabled","disabled").attr("placeholder","chat ended."),this.$sendButton.css("pointer-events","none"),this.$endConversationView.find(".hfc-end-confirmation").hide(),this.$endConversationView.animate({"margin-top":"0px"}),this.$conversationView.find(".hfc-is-typing-status").show(),this.$optionsDrawer.find(".hfc-close").hide(),this.$chatWindowTitleBar.find(".hfc-chat-ended-label").show(),this.$conversationContainer.addClass("hfc-longer"),this.$conversationEndedContainer.css({"background-color":"#"+A.primaryColor}),this.mailChimpIntegrationEnabled;for(var a=0;a<=z.integrationInfo.length-1;a++)if("mailchimp"===z.integrationInfo[a].name){A.messages.SUBSCRIBE_NEWSLETTER_PAGE.SUBSCRIPTION_REQUEST_TEXT=z.integrationInfo[a].settings.subscriptionRequestText,this.mailChimpIntegrationEnabled=z.integrationInfo[a];break}for(a=0;a<=z.visitorIntegrationInfo.length-1;a++)if("mailchimp"===z.visitorIntegrationInfo[a].name){A.mailChimpIntegrationInfo=z.visitorIntegrationInfo[a];break}this.mailChimpIntegrationInfoGlobal=A.mailChimpIntegrationInfo&&A.mailChimpIntegrationInfo.result.status;var b=this.mailChimpIntegrationEnabled&&"subscribed"!==this.mailChimpIntegrationInfoGlobal&&!A.skipSubscription&&z.currentUser.name,d=!A.options.hideRatingForm&&!z.currentUser.hasRated&&z.hasAgentInteracted&&!A.skipRating;if(b)d?A.showRatingFormView():A.showNewsletterView();else if(d)A.showRatingFormView();else{z.currentUser.hasRated=!1,z.hasAgentInteracted=!1,A.skipRating=!1,this.$conversationEndedContainer.animate({"margin-bottom":"0"},250),window.setTimeout(function(){A.addNotification("&mdash; This conversation has ended &mdash;")},0),A.$container.find(".hfc-theme-overlay").hide(),A.$overlay.hide(),A.$conversationContainer.show(),A.$endConversationView.animate({"margin-top":"-240px"}),z.getAgentDisplayImage(),A.showAgentDisplayImage();var e=this.$conversationEndedContainer.find(".hfc-return-to-website"),f=c("return_to");h({overrideConfig:!0})&&f?e.show().attr("href",f):e.hide(),this.$minimizedViewContainer.find(".hfc-badge-title").text(A.messages.HEADER.MINIMIZED_ONLINE_MESSAGE),this.$conversationContainer.css({height:"253px"}),this.minimizeTimer=window.setTimeout(function(){A.showMinimizedChatWindow()},25e3)}z.currentUser.deactivated=!0},displayOfflineStatus:function(){this.$conversationView.find(".hfc-end-conversation-dialog").hide(),this.$conversationView.find(".hfc-message").attr("disabled","disabled").attr("placeholder",""),this.$sendButton.css("pointer-events","none"),n('<p class="hfc-conversation-closed">Looks like you just missed us. We will get back to you soon.</p>').insertAfter(".hfc-conversation")},updateTypingStatus:function(){if(!A.visitorTypingStatus.isTyping){var a=!1;if(null!==this.visitorTypingStatus.lastUpdated){var b=new Date,c=this.visitorTypingStatus.lastUpdated;a=b-c>=z.VISITOR_TYPING_TIMEOUT}else a=!0;a&&(A.visitorTypingStatus.isTyping=!0,A.visitorTypingStatus.lastUpdated=new Date,z.updateTypingStatus())}},showAutoMessage:function(){var a,b=!1;if(n(".hfc-quote-container .hfc-quote").length>0&&(b=!0),this.autoMessageShown=A.$conversationView.find(".hfc-auto-message").length>0,!this.autoMessageShown&&!b){var c=this.processTemplate(this.linkifyMessage(A.messages.CONVERSATION_PAGE.FIRST_AUTO_MESSAGE),{visitorName:z.currentUser.name});A.addAgentMessage("",c,"",!1,!0),a=n("<span/>",{"class":"hfc-auto-message"}),n(".hfc-quote").first().append(a),this.autoMessageShown=!0}},beginConversation:function(){z.saveCurrentUserInfo(),this.showAutoMessage(),A.showConversationView()},hideDialogs:function(){A.$conversationOverlay.hide(),A.hideActionsMenu(),A.hideOptionsDrawer(),A.$endConversationView.animate({"margin-top":"-240px"}),A.hideEmailView(),A.$conversationEndedContainer.removeClass("blurred")},hideEmailView:function(){A.$overlay.fadeOut(),A.$emailTranscriptView.hide(),A.$emailConfirmationView.hide()},showEmailDrawer:function(a){a?(A.$conversationEndedContainer.addClass("blurred"),A.$emailTranscriptView.find(".hfc-mail-continue").hide()):A.$emailTranscriptView.find(".hfc-mail-continue").show(),A.$overlay.fadeIn("fast"),A.hideOptionsDrawer(),A.hideActionsMenu(),A.$emailTranscriptView.show(),A.$emailTranscriptView.find(".hfc-visitor-email").val("undefined"==z.currentUser.email?"":z.currentUser.email),A.$emailConfirmationView.hide()},showEmailConfirmationDrawer:function(){A.$emailTranscriptView.hide(),A.$emailSuccessIconContainer.html('<img src="'+a.ASSETS_URL+'/images/success.png" />'),A.$emailConfirmationView.show(),A.showingEmailSuccess=!0,A.hideEmailSuccess=window.setTimeout(function(){A.$emailConfirmationView.hide(),A.$overlay.fadeOut(),A.$conversationEndedContainer.removeClass("blurred"),A.showingEmailSuccess=!1},3e3)},showOptionsDrawer:function(){A.showingEmailSuccess===!0&&clearTimeout(A.hideEmailSuccess),A.hideEmailView(),A.$endConversationView.animate({"margin-top":"-240px"}),A.hideActionsMenu(),A.$optionsDialog.show(),A.hasVisitorMessages()?(A.$optionsDrawer.find(".hfc-email-link").show(),A.$optionsDrawer.find(".hfc-close").show()):(A.$optionsDrawer.find(".hfc-email-link").hide(),A.$optionsDrawer.find(".hfc-close").hide()),z.currentUser.active||A.$optionsDrawer.find(".hfc-close").hide(),A.$optionsDialog.find(".hfc-overlay").fadeIn("fast"),A.pushMenuOpen=!0,A.$optionsDrawer.animate({"margin-right":"0"},250,function(){})},hideOptionsDrawer:function(){A.$optionsDialog.find(".hfc-overlay").fadeOut(),A.pushMenuOpen=!1,A.$optionsDrawer.animate({"margin-right":"-150px"},250,function(){A.$optionsDialog.hide()})},showActionsMenu:function(){A.$conversationOverlay.fadeIn("fast"),A.$conversationView.find(".hfc-reply-area .hfc-actions-list").show().animate({"margin-left":"0"},250),A.$conversationView.find(".hfc-actions-list").removeClass("hfc-disabled"),A.actionsMenuOpen=!0},hideActionsMenu:function(){A.$conversationOverlay.fadeOut("fast"),A.$conversationView.find(".hfc-reply-area .hfc-actions-list").animate({"margin-left":"-200px"},250),A.actionsMenuOpen=!1},resetAgentTypingTimeout:function(){A.currentTypingTimeout&&window.clearTimeout(A.currentTypingTimeout),A.currentTypingTimeout=window.setTimeout(function(){n(".hfc-agent-typing-status").remove(),n(".hfc-typing-indicator").hide()},z.AGENT_TYPING_TIMEOUT)},handleAgentJoinNotification:function(a,b){A.$minimizedViewContainer.find(".hfc-badge-title").text(z.currentAgents[a].name);var c=z.currentAgents[a].name;n(".hfc-badge-title").text(c),z.getAgentDisplayImage(a),A.showAgentDisplayImage(),A.$chatWindowTitle.text(c).show(),z.setInfo({"user.agent_chat_id":a}),b||A.addNotification("&mdash; "+z.currentAgents[a].name+" has joined the conversation. &mdash;")},setAgentDisplayImage:function(b){b.result&&b.result.profile_url?A.agentDisplayImageUrl=b.result.profile_url:A.agentDisplayImageUrl=a.ASSETS_URL+"/images/floating-widget-circle.png",z.currentUser.active||z.currentUser.engageRequest||(A.agentDisplayImageUrl=a.ASSETS_URL+"/images/floating-widget-circle.png"),A.showAgentDisplayImage()},removeAgentDisplayImage:function(){var b=a.ASSETS_URL+"/images/floating-widget-circle.png";n(".hfc-title-bar-icon").attr("src",b),n(".hfc-badge-icon").attr("src",b)},showAgentDisplayImage:function(a){A.options.appearance.showAgentPicture&&(a||A.agentDisplayImageUrl)&&(n(".hfc-title-bar-icon").attr("src",a||A.agentDisplayImageUrl),n(".hfc-badge-icon").attr("src",a||A.agentDisplayImageUrl))},restartConversation:function(){A.$overlay.fadeOut(),A.addNotification("&mdash; You have started a new conversation &mdash;"),A.showConversationView(),A.hideChatAgainView(),A.activateVisitor(),A.$conversationView.find(".hfc-message").focus(),z.conversationId=null},hideChatAgainView:function(){this.$conversationContainer.hasClass("hfc-longer")&&(A.$endConversationView.animate({"margin-top":"-100px"}),A.$conversationEndedContainer.animate({"margin-bottom":"-240px"},250),A.$conversationContainer.removeClass("hfc-longer"),A.$chatWindowTitleBar.css({"background-color":A.primaryColor}),A.$chatWindowTitleBar.find(".hfc-chat-ended-label").hide(),A.$conversationView.find(".hfc-message").focus())},setupHFChatEvents:function(){n(z).on(z.EVENTS.READY,function(b,c){var d,e=n("<div></div>").attr("id","hfc-embed-container");d=h()?c.data.widget_mobile_html:c.data.widget_html,e.html(d),e.appendTo("body:first");var f=n(".hfc-default-minimized-view-mobile"),i=c.data.widget.appearance,j=i.primaryColor,k=i.secondaryColor;

f.css({"background-color":"#"+j}),f.find(".hfc-badge-title-mobile").css({color:"#"+k}),!g()&&h()&&(n(".hfc-default-minimized-view-mobile").addClass("non-responsive"),n(".hfc-proactive-notification, .hfc-proactive-message, .hfc-proactive-reply-prompt, .hfc-proactive-minimize").addClass("is-mobile")),e.hide(),n("#hfc-badge-icon").attr("src",a.ASSETS_URL+"/images/floating-widget-circle.png"),n("#hfc-title-bar-icon").attr("src",a.ASSETS_URL+"/images/floating-widget-circle.png"),n("#hfc-send-arrow").attr("src",a.ASSETS_URL+"/images/send-arrow.png"),n("#hfc-actions-menu").attr("src",a.ASSETS_URL+"/images/widget-actions-menu.png"),n("#hfc-email-icon").attr("src",a.ASSETS_URL+"/images/email-icon.png"),n("#hfc-exit-icon").attr("src",a.ASSETS_URL+"/images/exit-icon.png"),n("#hfc-return-arrow").attr("src",a.ASSETS_URL+"/images/send-arrow.png"),n("#hfc-offline-message-success").attr("src",a.ASSETS_URL+"/images/success.png"),n("#hfc-cleanslate .hfc-arrow-img").attr("src",a.ASSETS_URL+"/images/send-arrow.png");var l=n("<img />",{"class":"hfc-title-options",src:a.ASSETS_URL+"/images/widget-dots-menu.png"});if(l.appendTo(".hfc-title-bar"),"000000"===k)var m=n("<img />",{"class":"hfc-start-arrow",src:a.ASSETS_URL+"/images/send-arrow.png"}),o=n("<img />",{"class":"hfc-start-arrow",src:a.ASSETS_URL+"/images/send-arrow.png"});else var m=n("<img />",{"class":"hfc-start-arrow",src:a.ASSETS_URL+"/images/send-arrow.png"}),o=n("<img />",{"class":"hfc-start-arrow",src:a.ASSETS_URL+"/images/send-arrow.png"});m.appendTo(".hfc-start"),o.appendTo(".hfc-send-offline-msg"),A.init(c),z.init()}),n(z).on(z.EVENTS.PROACTIVE_CONDITION_MATCHED,function(a,c){b.log("Hit proactive chat",a,c),z.formShown||A.agentsOffline||A.hasVisitorMessages()||(b.log("Opening chat because of",a,c),A.showUserInfoFormView(),r._trigger(r.EVENTS.PROACTIVE_CHAT_TRIGGERED,c.trigger.name))}),n(z).on(z.EVENTS.AGENTS_AVAILABILITY_CHANGED,function(c,d){function e(){if(n("#hfc-embed-container").show(),z.companyReferralCode){var a=n("#hfc-embed-container a.hfc-referral-link:first").attr("href");n("#hfc-embed-container a.hfc-referral-link").attr("href",a+"?r="+z.companyReferralCode)}A.$container.show(),h()||(A.maximizedOnLoad?A.showUserInfoFormView():A.showMinimizedView())}return A.agentsOffline=!d.available,n(".hfc-options-gear").attr("src",a.ASSETS_URL+"/images/options-gear.png"),n("#hfc-email-message-success").attr("src",a.ASSETS_URL+"/images/success.png"),n("#hfc-newsletter-subscription-success-img").attr("src",a.ASSETS_URL+"/images/success.png"),n("#hfc-rating-success-img").attr("src",a.ASSETS_URL+"/images/success.png"),n("#hfc-offline-message-success").attr("src",a.ASSETS_URL+"/images/success.png"),n("#hfChatAudio").length||n('<audio id="hfChatAudio"><source src="'+a.ASSETS_URL+'/sounds/notify.mp3" type="audio/mpeg"></audio>').appendTo("body:first"),h()&&A.agentsOffline?void n("#hfc-embed-container").hide():void(A.checkIfCSSIsLoaded()?(e(),z.evaluateProactiveChatConditions()):b.log("Hiding as CSS is not loaded"))}),n(z).on(z.EVENTS.STATE_CHANGED,function(a,b){b.state?A.activateVisitor():(z.agentsOffline=!0,A.deactivateVisitor())}),n(z).on(z.EVENTS.SESSION_CREATED,function(a,c){if(b.log("Session created."),!h()&&c){c.reconnected&&(z.currentAgents={});var d,e,f,g=[];for(d=c.client_state.events.length-1;d>=0;d--){var i=c.client_state.events[d].event;if(e=i[0],f=i[1],i.timestamp=c.client_state.events[d].timestamp,e===z.NOTIFICATIONS.VISITOR_BECAME_INACTIVE)break;e!==z.NOTIFICATIONS.VISITOR_SESSION_BEGAN_EVENT&&e!==z.NOTIFICATIONS.VISITOR_SESSION_ENDED_EVENT&&g.push(i)}g=g.reverse(),g[0][0]===z.NOTIFICATIONS.AGENT_LEFT_EVENT&&g.splice(0,1);var j=[z.NOTIFICATIONS.VISITOR_MESSAGE_EVENT,z.NOTIFICATIONS.AGENT_MESSAGE_EVENT,z.NOTIFICATIONS.AGENT_JOINED_EVENT,z.NOTIFICATIONS.AGENT_LEFT_EVENT,z.NOTIFICATIONS.VISITOR_METADATA_EVENT],k=n(g).filter(function(a,b){return e=b[0],-1!==n.inArray(e,j)}),l=k.length-1;for(d=l;d>=0;d--)if(e=k[d][0],e===z.NOTIFICATIONS.VISITOR_MESSAGE_EVENT||e===z.NOTIFICATIONS.AGENT_MESSAGE_EVENT){l=d;break}if(z.currentUser.newConversation=0===k.length,n.each(c.client_state.joined_agents,function(a,b){z.currentAgents[b.agent_id]={name:b.name},A.handleAgentJoinNotification(b.agent_id,!0)}),!z.currentUser.newConversation||c.reconnected){A.$conversationView.find(".hfc-quote-container").remove(),c.reconnected?A.showUserInfoFormView():A.showConversationView(),c.client_state.joined_agents||A.handleAgentLeaving();var m=[];if(n.each(k,function(a,b){var c=b[0],d=b[1];switch(c){case z.NOTIFICATIONS.VISITOR_METADATA_EVENT:switch(d.name){case z.NOTIFICATIONS.VISITOR_ENGAGE_METADATA_CODE:m.push(d.value)}}}),m.length>0){var o=m[m.length-1];if(o){try{o=JSON.parse(o)}catch(p){b.error("Caught error while trying to parse lastEngageMetaData. Error:",p),o={}}o.message&&A.addEngageMessages(o.message)}}n.each(k,function(a,b){var c=b[0],d=b[1],e="";if(a===l){var f=new Date(0);f.setUTCSeconds(b.timestamp),e=A.getTimestamp(f)}c===z.NOTIFICATIONS.VISITOR_MESSAGE_EVENT&&A.addVisitorMessage(d.text,e,!1),c===z.NOTIFICATIONS.AGENT_MESSAGE_EVENT&&"AgentModifiedTag"!==d.message_type&&(A.addAgentMessage(d.agent_name,d.text,e,!1),z.hasAgentInteracted=!0),c===z.NOTIFICATIONS.AGENT_JOINED_EVENT&&(A.addNotification("&mdash; "+d.agent_name+" has joined the conversation. &mdash;"),z.currentAgents[d.agent_id]&&(z.currentAgents[d.agent_id].joinedAt=b.timestamp)),c===z.NOTIFICATIONS.AGENT_LEFT_EVENT&&A.addNotification("&mdash; "+d.agent_name+" has left the conversation. &mdash;"),"VisitorMetadata"===c&&"conversationId"===d.name&&(z.conversationId=d.value)}),A.$conversationContainer.animate({scrollTop:A.$conversationContainer[0].scrollHeight},"fast"),n(".hfc-quote-container.sending img.hfc-loading").hide(),n(".hfc-quote-timestamp").hide(),n(".hfc-quote-container.new-quote").last().find(".hfc-quote-timestamp").show(),n(".hfc-quote-container.sending").removeClass("sending")}else A.maximizedOnLoad&&A.showUserInfoFormView()}}),n(z).on(z.EVENTS.REGISTERED,function(a,b){A.beginConversation()}),n(z).on(z.EVENTS.CHAT_WIDGET_STATUS,function(a,b){A.displayOfflineStatus()}),n(z).on(z.EVENTS.NOTIFICATIONS_RECEIVED,function(a,b){n.each(b.notifications,function(a,b){function c(){A.addVisitorMessage(e.text,""),n(".hfc-quote-container.sending img.hfc-loading").hide(),n(".hfc-quote-container.sending").removeClass("sending")}var d=b[0],e=b[1];if(d===z.NOTIFICATIONS.AGENT_JOINED_EVENT&&(z.currentAgents[e.agent_id]={name:e.agent_name,joinedAt:(new Date).getTime()},z.currentAgents[e.agent_id]&&A.handleAgentJoinNotification(e.agent_id),r._trigger(r.EVENTS.AGENT_JOINED,e.agent_name),z.setState(z.STATES.CHATTING),z.conversationId||(z.conversationId=z.Random.guid(),z.addMetadata({conversationId:z.conversationId}))),d===z.NOTIFICATIONS.AGENT_SENT_MESSAGE_EVENT)switch(e.message_type){case"AgentModifiedTag":break;default:A.addAgentMessage(e.agent_name,e.text,A.getTimestamp()),A.updateUnreadNotificationCount(),A.playNotificationSound(),n(".hfc-quote-timestamp").fadeOut("fast"),n(".hfc-quote-container:last-child .hfc-quote-timestamp").fadeIn("fast"),A.$conversationView.find(".hfc-is-typing-status").html(""),z.updateCurrentUserState(!0),A.pageActive||(document.title="New message from "+e.agent_name),z.hasAgentInteracted=!0}if(d===z.NOTIFICATIONS.VISITOR_SENT_MESSAGE_EVENT){n(".hfc-ended-message:visible").length>0&&A.restartConversation();try{var f=JSON.parse(e.text);"VisitorDataFromIntegration"!==f.messageType&&c()}catch(g){c()}}if(d===z.NOTIFICATIONS.VISITOR_IS_TYPING_EVENT&&(A.$conversationView.find(".hfc-is-typing-status").html('<span class="hfc-visitor-typing-status">You are typing&hellip;'),window.setTimeout(function(){n(".hfc-visitor-typing-status").remove()},z.VISITOR_TYPING_TIMEOUT)),d===z.NOTIFICATIONS.AGENT_IS_TYPING_EVENT&&(0===n(".hfc-agent-typing-status").length&&(A.$conversationView.find(".hfc-is-typing-status").html('<span class="hfc-agent-typing-status">'+z.currentAgents[e.agent_id].name+" is typing&hellip;"),n(".hfc-typing-indicator").show()),A.resetAgentTypingTimeout()),d===z.NOTIFICATIONS.AGENT_LEFT_EVENT){A.handleAgentLeaving(e.agent_id),z.endEngageChat();var h=Object.keys(z.currentAgents).length;(0>=h||1===h&&z.currentAgents[e.agent_id])&&z.setState(z.STATES.PASSIVE)}d===z.NOTIFICATIONS.AGENT_AVAILABILITY_EVENT&&A.handleAvailability(e.available),d===z.NOTIFICATIONS.VISITOR_DEACTIVATED_EVENT&&z.updateCurrentUserState(!1),z.readNotificationCount+=1}),z.updateNotificationCount()}),n(z).on(z.EVENTS.MESSAGE_SENT,function(a,b){A.$conversationContainer.animate({scrollTop:A.$conversationContainer[0].scrollHeight},"fast"),n(".hfc-quote-container").find("img.hfc-loading."+b.id).hide(),n(".hfc-quote-container:last-child .hfc-quote-timestamp").fadeIn("fast"),n(".hfc-quote-container.sending").removeClass("sending")})},handleAvailability:function(a){A.agentsOffline=!a,A.$currentView&&(A.$currentView===A.$minimizedViewContainer&&A.showMinimizedView(),A.agentsOffline&&z.endEngageChat(),z.currentUser.active||(A.agentsOffline?A.$endConversationView.find(".hfc-ended-action").hide():A.$endConversationView.find(".hfc-ended-action").show()))},setupUIEvents:function(){function a(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}this.$mobileBadge.on("click",function(a){z.openCompanyChatPage()}),A.$proactiveNotification.find(".hfc-proactive-minimize").on("click",function(a){a.stopPropagation(),A.hideProactiveNotification()}),A.$proactiveNotificationMobile.find(".hfc-proactive-minimize").on("click",function(a){a.stopPropagation(),A.hideProactiveNotification()}),this.$chatWindowTitleBar.on("click",function(a){if(A.allowMinimize){var b=A.$chatWindowBody.is(":hidden");A.minimizeTimer&&window.clearInterval(A.minimizeTimer),b?(z.currentUser.unreadNotificationCount=0,A.restoreChatWindow()):A.showMinimizedChatWindow()}return a.preventDefault(),a.stopPropagation(),!1}.bind(this)),this.$conversationEndedContainer.find(".hfc-email-transcript").on("click",function(){this.ended=!0,A.showEmailDrawer(this.ended),A.minimizeTimer&&window.clearInterval(A.minimizeTimer)}),this.$offlineView.find(".hfc-send-offline-msg").on("click",function(a){var b=A.validateFields(A.$offlineView.find(".hfc-form"));return b.name&&b.email&&b.message&&(n(this).find(".hfc-offline-text").text("Just a moment... "),z.sendOfflineMessage(b)),a.preventDefault(),!1}),this.$offlineView.find('.hfc-form input[name="name"]').on("change input",a(function(){A.validateName(A.$offlineView.find(".hfc-form"))},500)),this.$offlineView.find('.hfc-form input[name="email"]').on("change input",a(function(){A.validateEmail(A.$offlineView.find(".hfc-form"))},500)),this.$container.find('.hfc-newsletter-subscribe input[name="email"]').on("change input",a(function(){A.validateEmail(A.$container.find(".hfc-newsletter-subscribe"))},500)),this.$offlineView.find('.hfc-form textarea[name="message"]').on("change input",a(function(){A.validateMessage(A.$offlineView.find(".hfc-form"))},500)),this.$offlineView.find(".hfc-form").on("submit",function(a){a.preventDefault()}),n(".hfc-material-input input, .hfc-material-input textarea").on("blur",function(a){this.targetInput=n(a.target),this.targetInput.val()?this.targetInput.addClass("used"):this.targetInput.removeClass("used")}),this.$userInfoViewContainer.find(".hfc-start").on("click",function(a){var b=A.validateFields();return b&&(n(this).find(".hfc-start-text").text("Just a moment... "),z.initUser(b.name,b.email,b.message)),a.preventDefault(),!1}),this.$userInfoViewContainer.find('.hfc-form input[name="name"]').on("change input",a(function(){A.validateName()},500)),this.$userInfoViewContainer.find('.hfc-form input[name="email"]').on("change input",a(function(){A.validateEmail()},500)),this.$userInfoViewContainer.find(".hfc-form").on("submit",function(a){a.preventDefault()}),n(".hfc-close").on("click",function(a){A.showEndConversationView(),a.stopPropagation()}),this.$conversationView.find(".hfc-reply-area .hfc-actions-container").on("click",function(){A.actionsMenuOpen===!1?A.hasVisitorMessages()&&A.showActionsMenu():A.hideActionsMenu()}),this.$conversationOverlay.on("click",function(){A.hideActionsMenu()}),this.$menuIcon.on("click",function(a){this.pushMenuOpen?(A.$pushMenu.find(".hfc-push-icon").fadeOut("fast",function(){A.$pushMenu.animate({width:"0px"},100),A.$conversationView.find(".hfc-conversation").animate({left:"0px"},100)}),this.pushMenuOpen=!1):(A.$pushMenu.animate({width:"35px"},100),A.$conversationView.find(".hfc-conversation").animate({left:"35px"},100,function(){A.$pushMenu.find(".hfc-push-icon").fadeIn("fast")}),this.pushMenuOpen=!0),a.stopPropagation()}),this.$container.find(".hfc-badge").on("click",function(){var a=A.$chatWindow.is(":hidden");a&&(z.currentUser.unreadNotificationCount=0,A.restoreChatWindow(),r._trigger(r.EVENTS.CHAT_WINDOW_OPENED)),A.showUserInfoFormView()}.bind(this)),this.$conversationView.find(".hfc-end-conversation").on("click",function(a){A.showEndConversationView()}),this.$endConversationView.find(".hfc-confirm.continue").on("click",function(a){A.showConversationView(),A.$endConversationView.animate({"margin-top":"-240px"}),A.$overlay.fadeOut()}),this.$endConversationView.find(".hfc-confirm.leave").on("click",function(a){z.deactivateVisitor(),A.$overlay.fadeOut(),A.$endConversationView.animate({"margin-top":"-240px"})}),this.$hfcNewsletterSubscribeButton.on("click",function(a){A.$hfcSubscribeVisitorEmailInput.hasClass("error")||(A.$hfcNewsletterSubscribe.hide(),A.$hfcNewsletterSubscriptionConfirmation.show(),z.postIntegrationData("mailchimp",{name:z.currentUser.name,email:A.$hfcSubscribeVisitorEmailInput.val()}),A.mailChimpIntegrationInfo.result.status="subscribed",setTimeout(function(){A.$hfcNewsletterSubscriptionConfirmation.hide(),A.deactivateVisitor()},3e3))}),this.$hfcSkipSubscription.on("click",function(a){A.skipSubscription=!0,A.deactivateVisitor()}),this.$hfcRatingSubmitButton.on("click",function(a){return A.currentRating?(n(".hfc-rating-error").hide(),A.$hfcRatingsCt.hide(),A.$hfcRatingConfirmation.show(),z.submitRatings({visitorChatId:z.currentUser.visitorId,type:"visitor-given",ratings:A.currentRating,ratingsFeedback:A.$hfcRatingFeedbackTextbox.val().trim(),ratedOn:(new Date).toISOString(),conversationId:z.conversationId}),void setTimeout(function(){A.clearRatingForm(),z.currentUser.hasRated=!0,A.$hfcRatingConfirmation.hide(),A.deactivateVisitor()},3e3)):void n(".hfc-rating-error").show()}),this.$hfcSkipRatingButton.on("click",function(a){A.skipRating=!0,z.currentUser.hasRated=!1,A.$hfcRatingsCt.hide(),A.clearRatingForm(),A.deactivateVisitor()}),this.$conversationEndedContainer.find(".hfc-chat-again").on("click",function(){A.restartConversation(),A.minimizeTimer&&window.clearInterval(A.minimizeTimer)}),n(".hfc-send-email-transcript").on("click",function(a){z.sendTranscriptEmail(),n(this).parent().html("An email has been sent to<br> "+z.currentUser.email)}),this.$conversationView.find(".hfc-options span").on("click",function(){n(this).parent().find(".hfc-dropdown").slideToggle("fast")}),this.$chatWindowTitleBar.find(".hfc-title-options").on("click",function(a){A.pushMenuOpen?A.hideOptionsDrawer():A.showOptionsDrawer(),a.stopPropagation()}),this.$optionsDrawer.find(".hfc-email-link").on("click",function(){A.showEmailDrawer()}),this.$optionsDrawer.find(".hfc-minimize").on("click",function(){A.showMinimizedChatWindow()}),this.$conversationView.find(".hfc-actions-email").on("click",function(){A.showEmailDrawer()}),this.$muteContainer.on("click",function(){A.playSound=!A.playSound,A.updateSoundNotificationOption(),A.hideOptionsDrawer()}),this.$optionsDialog.find(".hfc-overlay").on("click",function(){A.hideOptionsDrawer()}),this.$overlay.on("click",function(){A.hideOptionsDrawer(),A.hideDialogs()}),this.$emailTranscriptView.find(".hfc-visitor-email").on("change input",a(function(){A.validateEmail(A.$emailTranscriptView)},500)),this.$emailTranscriptView.find(".hfc-mail").on("click",function(){var a=n.trim(A.$emailTranscriptView.find(".hfc-visitor-email").val());A.validateEmail(A.$emailTranscriptView)&&(z.sendTranscriptEmail(a),A.showEmailConfirmationDrawer())}),this.$emailTranscriptView.find(".hfc-mail-continue").on("click",function(){A.hideDialogs()}),this.$dismissLink.on("click",function(){A.hideOptionsDrawer()}),this.$dropDown.find(".hfc-options-list li").on("click",function(){n(this).parents(".hfc-dropdown").hide()}),this.$conversationView.find(".hfc-message").on("input",function(){A.$conversationView.find(".hfc-send").css(n(this).val().trim().length>0?{opacity:1}:{opacity:.5})}),this.$conversationView.find(".hfc-message").keypress(function(a){if(A.updateTypingStatus(),13===a.which){var b=n(this),c=b.val().trim();if(c.length>0){b.val(""),A.$conversationView.find(".hfc-send").css({opacity:.5}),A.focusInput?b.focus():b.blur();var d=(new Date).getTime();z.addVisitorMessage(c,A.getTimestamp(),d),A.addVisitorMessage(c,A.getTimestamp(),!0,d),A.$conversationContainer.find(".hfc-conversation").animate({scrollTop:n(".hfc-conversation")[0].scrollHeight},"slow").find(".hfc-quote-container").removeClass("new-quote")}return b.trigger("change"),!1}return!0}),this.$conversationView.find(".hfc-send").on("click",function(){A.updateTypingStatus();var a=A.$conversationView.find(".hfc-message"),b=a.val().trim();if(b.length>0){a.val(""),A.$conversationView.find(".hfc-send").css({opacity:.5}),A.focusInput?a.focus():a.blur();var c=(new Date).getTime();z.addVisitorMessage(b,A.getTimestamp(),c),A.addVisitorMessage(b,A.getTimestamp(),!0,c),A.$conversationContainer.find(".hfc-conversation").animate({scrollTop:n(".hfc-conversation")[0].scrollHeight},"slow").find(".hfc-quote-container").removeClass("new-quote")}return a.trigger("change"),!1}),n(window).on("focus",function(){A.pageActive=!0,document.title=A.defaultPageTitle}),n(window).on("blur",function(){A.pageActive=!1}),this.$hfcRatingStar.on("click",this.setRatings),this.$hfcRatingStar.on("mouseenter",this.setRatingsHoverHandlerIn),this.$hfcRatingStar.on("mouseleave",this.setRatingsHoverHandlerOut)},setWidgetPos:function(a,b){var c=a,d=b;"minimize"===d?(("right"===c||"left"===c)&&this.$container.addClass("hfc-vertical-middle"),"left"===c&&this.$container.addClass("hfc-pos-left")):("bottomRight"!==c&&this.$container.removeClass("hfc-vertical-middle"),"left"===c&&this.$container.removeClass("hfc-pos-left"))},setRatings:function(a){n(".hfc-rating-error").hide(),A.$hfcRatingsCt.hasClass("hfc-rating-contain-feedback")||(A.$hfcRatingsCt.addClass("hfc-rating-contain-feedback"),A.$hfcRatingFeedbackCt.fadeIn(),A.$hfcRatingFeedbackTextbox.focus());var c=n(this),d=c.prevAll().addBack();A.$hfcRatingStar.removeClass("active current-rating"),d.addClass("active"),b.log("get rating value"),c.addClass("current-rating"),A.currentRating=c.data("rating"),b.log("Rating: "+A.currentRating)},setRatingsHoverHandlerIn:function(a){var b=n(this),c=n(".hfc-rating-star-label"),d=b.data("label");c.text(d);var e=b.prevAll().addBack();A.$hfcRatingStar.removeClass("active"),e.addClass("active")},setRatingsHoverHandlerOut:function(a){var b=(n(this),A.$hfcRatingsCt.find(".hfc-star.current-rating")),c=n(".hfc-rating-star-label"),d=b.data("label");if(b.length>0){var e=b.prevAll();A.$hfcRatingStar.removeClass("active"),e.addClass("active"),b.addClass("active"),c.text(d)}else A.$hfcRatingStar.removeClass("active"),c.text("")},clearRatingForm:function(){var a=A.$hfcRatingsCt.find(".hfc-star.current-rating");A.currentRating=null,A.$hfcRatingFeedbackTextbox.val(""),A.$hfcRatingStar.removeClass("active"),a.removeClass("current-rating"),n(".hfc-rating-star-label").text(""),A.$hfcRatingFeedbackCt.hide(),A.$hfcRatingsCt.removeClass("hfc-rating-contain-feedback")}};window.addEventListener?window.addEventListener("message",i,!1):window.attachEvent("onmessage",i),k(function(){l()})}(window.HFCHAT_CONFIG),function(){function a(b,d){function f(a){if(f[a]!==q)return f[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=f("json-stringify")&&f("json-parse");else{var c,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=d.stringify,k="function"==typeof i&&t;if(k){(c=function(){return 1}).toJSON=c;try{k="0"===i(0)&&"0"===i(new g)&&'""'==i(new h)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(c)&&"[1]"==i([c])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[c,!0,!1,null,"\x00\b\n\f\r	"]})==e&&"1"===i(null,c)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new j(-1))}catch(l){k=!1}}b=k}if("json-parse"==a){var m=d.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){c=m(e);var n=5==c.a.length&&1===c.a[0];if(n){try{n=!m('"	"')}catch(l){}if(n)try{n=1!==m("01")}catch(l){}if(n)try{n=1!==m("1.")}catch(l){}}}}catch(l){n=!1}b=n}}return f[a]=!!b}b||(b=e.Object()),d||(d=e.Object());var g=b.Number||e.Number,h=b.String||e.String,i=b.Object||e.Object,j=b.Date||e.Date,k=b.SyntaxError||e.SyntaxError,l=b.TypeError||e.TypeError,m=b.Math||e.Math,n=b.JSON||e.JSON;"object"==typeof n&&n&&(d.stringify=n.stringify,d.parse=n.parse);var o,p,q,r=i.prototype,s=r.toString,t=new j(-0xc782b5b800cec);try{t=-109252==t.getUTCFullYear()&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(u){}if(!f("json")){var v="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",z="[object Array]",A="[object Boolean]",B=f("bug-string-char-index");if(!t)var C=m.floor,D=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(a,b){return D[b]+365*(a-1970)+C((a-1969+(b=+(b>1)))/4)-C((a-1901+b)/100)+C((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var d,e,f,g=0;(d=function(){this.valueOf=0}).prototype.valueOf=0,e=new d;for(f in e)o.call(e,f)&&g++;return d=e=null,g?p=2==g?function(a,b){var c,d={},e=s.call(a)==v;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==v;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(e=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var d,f,g=s.call(a)==v,h=!g&&"function"!=typeof a.constructor&&c[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(d in a)g&&"prototype"==d||!h.call(a,d)||b(d);for(f=e.length;d=e[--f];h.call(a,d)&&b(d));}),p(a,b)},!f("json-stringify")){var F={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},G="000000",H=function(a,b){return(G+(b||0)).slice(-a)},I="\\u00",J=function(a){for(var b='"',c=0,d=a.length,e=!B||d>10,f=e&&(B?a.split(""):a);d>c;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=F[g];break;default:if(32>g){b+=I+H(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},K=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,v,B,D,F,G,I,L;try{h=b[a]}catch(M){}if("object"==typeof h&&h)if(i=s.call(h),i!=w||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=x&&i!=y&&i!=z||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&1/0>h){if(E){for(m=C(h/864e5),j=C(m/365.2425)+1970-1;E(j+1,0)<=m;j++);for(k=C((m-E(j,0))/30.42);E(j,k+1)<=m;k++);m=1+m-E(j,k),n=(h%864e5+864e5)%864e5,r=C(n/36e5)%24,t=C(n/6e4)%60,u=C(n/1e3)%60,v=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),v=h.getUTCMilliseconds();h=(0>=j||j>=1e4?(0>j?"-":"+")+H(6,0>j?-j:j):H(4,j))+"-"+H(2,k+1)+"-"+H(2,m)+"T"+H(2,r)+":"+H(2,t)+":"+H(2,u)+"."+H(3,v)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if(i=s.call(h),i==A)return""+h;if(i==x)return h>-1/0&&1/0>h?""+h:"null";if(i==y)return J(""+h);if("object"==typeof h){for(G=g.length;G--;)if(g[G]===h)throw l();if(g.push(h),B=[],I=f,f+=e,i==z){for(F=0,G=h.length;G>F;F++)D=K(F,h,c,d,e,f,g),B.push(D===q?"null":D);L=B.length?e?"[\n"+f+B.join(",\n"+f)+"\n"+I+"]":"["+B.join(",")+"]":"[]"}else p(d||h,function(a){var b=K(a,h,c,d,e,f,g);b!==q&&B.push(J(a)+":"+(e?" ":"")+b)}),L=B.length?e?"{\n"+f+B.join(",\n"+f)+"\n"+I+"}":"{"+B.join(",")+"}":"{}";return g.pop(),L}};d.stringify=function(a,b,d){var e,f,g,h;if(c[typeof b]&&b)if((h=s.call(b))==v)f=b;else if(h==z){g={};for(var i,j=0,k=b.length;k>j;i=b[j++],h=s.call(i),(h==y||h==x)&&(g[i]=1));}if(d)if((h=s.call(d))==x){if((d-=d%1)>0)for(e="",d>10&&(d=10);e.length<d;e+=" ");}else h==y&&(e=d.length<=10?d:d.slice(0,10));return K("",(i={},i[""]=a,i),f,g,e,"",[])}}if(!f("json-parse")){var L,M,N=h.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw L=M=null,k()},Q=function(){for(var a,b,c,d,e,f=M,g=f.length;g>L;)switch(e=f.charCodeAt(L)){case 9:case 10:case 13:case 32:L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=B?f.charAt(L):f[L],L++,a;case 34:for(a="@",L++;g>L;)if(e=f.charCodeAt(L),32>e)P();else if(92==e)switch(e=f.charCodeAt(++L)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=O[e],L++;break;case 117:for(b=++L,c=L+4;c>L;L++)e=f.charCodeAt(L),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||P();a+=N("0x"+f.slice(b,L));break;default:P()}else{if(34==e)break;for(e=f.charCodeAt(L),b=L;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++L);a+=f.slice(b,L)}if(34==f.charCodeAt(L))return L++,a;P();default:if(b=L,45==e&&(d=!0,e=f.charCodeAt(++L)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(L+1),e>=48&&57>=e)&&P(),d=!1;g>L&&(e=f.charCodeAt(L),e>=48&&57>=e);L++);if(46==f.charCodeAt(L)){for(c=++L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}if(e=f.charCodeAt(L),101==e||69==e){for(e=f.charCodeAt(++L),(43==e||45==e)&&L++,c=L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}return+f.slice(b,L)}if(d&&P(),"true"==f.slice(L,L+4))return L+=4,!0;if("false"==f.slice(L,L+5))return L+=5,!1;if("null"==f.slice(L,L+4))return L+=4,null;P()}return"$"},R=function(a){var b,c;if("$"==a&&P(),"string"==typeof a){if("@"==(B?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=Q(),"]"!=a;c||(c=!0))c&&(","==a?(a=Q(),"]"==a&&P()):P()),","==a&&P(),b.push(R(a));return b}if("{"==a){for(b={};a=Q(),"}"!=a;c||(c=!0))c&&(","==a?(a=Q(),"}"==a&&P()):P()),(","==a||"string"!=typeof a||"@"!=(B?a.charAt(0):a[0])||":"!=Q())&&P(),b[a.slice(1)]=R(Q());return b}P()}return a},S=function(a,b,c){var d=T(a,b,c);d===q?delete a[b]:a[b]=d},T=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==z)for(d=e.length;d--;)S(e,d,c);else p(e,function(a){S(e,a,c)});return c.call(a,b,e)};d.parse=function(a,b){var c,d;return L=0,M=""+a,c=R(Q()),"$"!=Q()&&P(),L=M=null,b&&s.call(b)==v?T((d={},d[""]=c,d),"",b):c}}}return d.runInContext=a,d}var b="function"==typeof define&&define.amd,c={"function":!0,object:!0},d=c[typeof exports]&&exports&&!exports.nodeType&&exports,e=c[typeof window]&&window||this,f=d&&c[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!f||f.global!==f&&f.window!==f&&f.self!==f||(e=f),d&&!b)a(e,d);else{var g=e.JSON,h=e.JSON3,i=!1,j=a(e,e.JSON3={noConflict:function(){return i||(i=!0,e.JSON=g,e.JSON3=h,g=h=null),j}});e.JSON={parse:j.parse,stringify:j.stringify}}b&&define(function(){return j})}.call(this)}}();