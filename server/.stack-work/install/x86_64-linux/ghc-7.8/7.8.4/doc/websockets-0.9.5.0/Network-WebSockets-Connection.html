<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Network.WebSockets.Connection</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Network-WebSockets-Connection.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">websockets-0.9.5.0: A sensible and clean way to write WebSocket-capable servers in Haskell.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell98</td></tr></table><p class="caption">Network.WebSockets.Connection</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module exposes connection internals and should only be used if you
 really know what you are doing.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:PendingConnection">PendingConnection</a> = <a href="#v:PendingConnection">PendingConnection</a> {<ul class="subs"><li><a href="#v:pendingOptions">pendingOptions</a> :: !<a href="Network-WebSockets-Connection.html#t:ConnectionOptions">ConnectionOptions</a></li><li><a href="#v:pendingRequest">pendingRequest</a> :: !<a href="Network-WebSockets.html#t:RequestHead">RequestHead</a></li><li><a href="#v:pendingOnAccept">pendingOnAccept</a> :: !(<a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ())</li><li><a href="#v:pendingStream">pendingStream</a> :: !<a href="Network-WebSockets-Stream.html#t:Stream">Stream</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:AcceptRequest">AcceptRequest</a> = <a href="#v:AcceptRequest">AcceptRequest</a> {<ul class="subs"><li><a href="#v:acceptSubprotocol">acceptSubprotocol</a> :: !(<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../bytestring-0.10.4.0/Data-ByteString.html#t:ByteString">ByteString</a>)</li></ul>}</li><li class="src short"><a href="#v:acceptRequest">acceptRequest</a> :: <a href="Network-WebSockets-Connection.html#t:PendingConnection">PendingConnection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a></li><li class="src short"><a href="#v:acceptRequestWith">acceptRequestWith</a> :: <a href="Network-WebSockets-Connection.html#t:PendingConnection">PendingConnection</a> -&gt; <a href="Network-WebSockets-Connection.html#t:AcceptRequest">AcceptRequest</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a></li><li class="src short"><a href="#v:rejectRequest">rejectRequest</a> :: <a href="Network-WebSockets-Connection.html#t:PendingConnection">PendingConnection</a> -&gt; <a href="../bytestring-0.10.4.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:Connection">Connection</a> = <a href="#v:Connection">Connection</a> {<ul class="subs"><li><a href="#v:connectionOptions">connectionOptions</a> :: !<a href="Network-WebSockets-Connection.html#t:ConnectionOptions">ConnectionOptions</a></li><li><a href="#v:connectionType">connectionType</a> :: !ConnectionType</li><li><a href="#v:connectionProtocol">connectionProtocol</a> :: !Protocol</li><li><a href="#v:connectionParse">connectionParse</a> :: !(<a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> (<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-WebSockets.html#t:Message">Message</a>))</li><li><a href="#v:connectionWrite">connectionWrite</a> :: !(<a href="Network-WebSockets.html#t:Message">Message</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ())</li><li><a href="#v:connectionSentClose">connectionSentClose</a> :: !(<a href="../base-4.7.0.2/Data-IORef.html#t:IORef">IORef</a> <a href="../base-4.7.0.2/Data-Bool.html#t:Bool">Bool</a>)</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:ConnectionOptions">ConnectionOptions</a> = <a href="#v:ConnectionOptions">ConnectionOptions</a> {<ul class="subs"><li><a href="#v:connectionOnPong">connectionOnPong</a> :: !(<a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ())</li></ul>}</li><li class="src short"><a href="#v:defaultConnectionOptions">defaultConnectionOptions</a> :: <a href="Network-WebSockets-Connection.html#t:ConnectionOptions">ConnectionOptions</a></li><li class="src short"><a href="#v:receive">receive</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets.html#t:Message">Message</a></li><li class="src short"><a href="#v:receiveDataMessage">receiveDataMessage</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets.html#t:DataMessage">DataMessage</a></li><li class="src short"><a href="#v:receiveData">receiveData</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> a</li><li class="src short"><a href="#v:send">send</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="Network-WebSockets.html#t:Message">Message</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:sendDataMessage">sendDataMessage</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="Network-WebSockets.html#t:DataMessage">DataMessage</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:sendTextData">sendTextData</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:sendBinaryData">sendBinaryData</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:sendClose">sendClose</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:sendCloseCode">sendCloseCode</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/Data-Word.html#t:Word16">Word16</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:sendPing">sendPing</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:forkPingThread">forkPingThread</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:PendingConnection" class="def">PendingConnection</a></p><div class="doc"><p>A new client connected to the server. We haven't accepted the connection
 yet, though.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:PendingConnection" class="def">PendingConnection</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:pendingOptions" class="def">pendingOptions</a> :: !<a href="Network-WebSockets-Connection.html#t:ConnectionOptions">ConnectionOptions</a></dt><dd class="doc"><p>Options, passed as-is to the <code><a href="Network-WebSockets-Connection.html#t:Connection">Connection</a></code></p></dd><dt class="src"><a name="v:pendingRequest" class="def">pendingRequest</a> :: !<a href="Network-WebSockets.html#t:RequestHead">RequestHead</a></dt><dd class="doc"><p>Useful for e.g. inspecting the request path.</p></dd><dt class="src"><a name="v:pendingOnAccept" class="def">pendingOnAccept</a> :: !(<a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ())</dt><dd class="doc"><p>One-shot callback fired when a connection is accepted, i.e., *after*
 the accepting response is sent to the client.</p></dd><dt class="src"><a name="v:pendingStream" class="def">pendingStream</a> :: !<a href="Network-WebSockets-Stream.html#t:Stream">Stream</a></dt><dd class="doc"><p>Input/output stream</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:AcceptRequest" class="def">AcceptRequest</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:AcceptRequest" class="def">AcceptRequest</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:acceptSubprotocol" class="def">acceptSubprotocol</a> :: !(<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../bytestring-0.10.4.0/Data-ByteString.html#t:ByteString">ByteString</a>)</dt><dd class="doc"><p>The subprotocol to speak with the client.  If <code>pendingSubprotcols</code> is
 non-empty, <code><a href="Network-WebSockets-Connection.html#v:acceptSubprotocol">acceptSubprotocol</a></code> must be one of the subprotocols from the
 list.</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:acceptRequest" class="def">acceptRequest</a> :: <a href="Network-WebSockets-Connection.html#t:PendingConnection">PendingConnection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a></p></div><div class="top"><p class="src"><a name="v:acceptRequestWith" class="def">acceptRequestWith</a> :: <a href="Network-WebSockets-Connection.html#t:PendingConnection">PendingConnection</a> -&gt; <a href="Network-WebSockets-Connection.html#t:AcceptRequest">AcceptRequest</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a></p></div><div class="top"><p class="src"><a name="v:rejectRequest" class="def">rejectRequest</a> :: <a href="Network-WebSockets-Connection.html#t:PendingConnection">PendingConnection</a> -&gt; <a href="../bytestring-0.10.4.0/Data-ByteString.html#t:ByteString">ByteString</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Connection" class="def">Connection</a></p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Connection" class="def">Connection</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:connectionOptions" class="def">connectionOptions</a> :: !<a href="Network-WebSockets-Connection.html#t:ConnectionOptions">ConnectionOptions</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:connectionType" class="def">connectionType</a> :: !ConnectionType</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:connectionProtocol" class="def">connectionProtocol</a> :: !Protocol</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:connectionParse" class="def">connectionParse</a> :: !(<a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> (<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="Network-WebSockets.html#t:Message">Message</a>))</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:connectionWrite" class="def">connectionWrite</a> :: !(<a href="Network-WebSockets.html#t:Message">Message</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ())</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:connectionSentClose" class="def">connectionSentClose</a> :: !(<a href="../base-4.7.0.2/Data-IORef.html#t:IORef">IORef</a> <a href="../base-4.7.0.2/Data-Bool.html#t:Bool">Bool</a>)</dt><dd class="doc"><p>According to the RFC, both the client and the server MUST send
 a close control message to each other.  Either party can initiate
 the first close message but then the other party must respond.  Finally,
 the server is in charge of closing the TCP connection.  This IORef tracks
 if we have sent a close message and are waiting for the peer to respond.</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ConnectionOptions" class="def">ConnectionOptions</a></p><div class="doc"><p>Set options for a <code><a href="Network-WebSockets-Connection.html#t:Connection">Connection</a></code>.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ConnectionOptions" class="def">ConnectionOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:connectionOnPong" class="def">connectionOnPong</a> :: !(<a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ())</dt><dd class="doc"><p>Whenever a <code>pong</code> is received, this IO action is executed. It can be
 used to tickle connections or fire missiles.</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:defaultConnectionOptions" class="def">defaultConnectionOptions</a> :: <a href="Network-WebSockets-Connection.html#t:ConnectionOptions">ConnectionOptions</a></p></div><div class="top"><p class="src"><a name="v:receive" class="def">receive</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets.html#t:Message">Message</a></p></div><div class="top"><p class="src"><a name="v:receiveDataMessage" class="def">receiveDataMessage</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="Network-WebSockets.html#t:DataMessage">DataMessage</a></p><div class="doc"><p>Receive an application message. Automatically respond to control messages.</p><p>When the peer sends a close control message, an exception of type <code><a href="Network-WebSockets.html#v:CloseRequest">CloseRequest</a></code>
 is thrown.  The peer can send a close control message either to initiate a
 close or in response to a close message we have sent to the peer.  In either
 case the <code><a href="Network-WebSockets.html#v:CloseRequest">CloseRequest</a></code> exception will be thrown.  The RFC specifies that
 the server is responsible for closing the TCP connection, which should happen
 after receiving the <code><a href="Network-WebSockets.html#v:CloseRequest">CloseRequest</a></code> exception from this function.</p><p>This will throw <code><a href="Network-WebSockets.html#v:ConnectionClosed">ConnectionClosed</a></code> if the TCP connection dies unexpectedly.</p></div></div><div class="top"><p class="src"><a name="v:receiveData" class="def">receiveData</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> a</p><div class="doc"><p>Receive a message, converting it to whatever format is needed.</p></div></div><div class="top"><p class="src"><a name="v:send" class="def">send</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="Network-WebSockets.html#t:Message">Message</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p></div><div class="top"><p class="src"><a name="v:sendDataMessage" class="def">sendDataMessage</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="Network-WebSockets.html#t:DataMessage">DataMessage</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send a <code><a href="Network-WebSockets.html#t:DataMessage">DataMessage</a></code></p></div></div><div class="top"><p class="src"><a name="v:sendTextData" class="def">sendTextData</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send a message as text</p></div></div><div class="top"><p class="src"><a name="v:sendBinaryData" class="def">sendBinaryData</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send a message as binary data</p></div></div><div class="top"><p class="src"><a name="v:sendClose" class="def">sendClose</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send a friendly close message.  Note that after sending this message,
 you should still continue calling <code><a href="Network-WebSockets-Connection.html#v:receiveDataMessage">receiveDataMessage</a></code> to process any
 in-flight messages.  The peer will eventually respond with a close control
 message of its own which will cause <code><a href="Network-WebSockets-Connection.html#v:receiveDataMessage">receiveDataMessage</a></code> to throw the
 <code><a href="Network-WebSockets.html#v:CloseRequest">CloseRequest</a></code> exception.  This exception is when you can finally consider
 the connection closed.</p></div></div><div class="top"><p class="src"><a name="v:sendCloseCode" class="def">sendCloseCode</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/Data-Word.html#t:Word16">Word16</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send a friendly close message and close code.  Similar to <code><a href="Network-WebSockets-Connection.html#v:sendClose">sendClose</a></code>,
 you should continue calling <code><a href="Network-WebSockets-Connection.html#v:receiveDataMessage">receiveDataMessage</a></code> until you receive a
 <code><a href="Network-WebSockets.html#v:CloseRequest">CloseRequest</a></code> exception.</p><p>See <a href="http://tools.ietf.org/html/rfc6455#section-7.4">http://tools.ietf.org/html/rfc6455#section-7.4</a> for a list of close
 codes.</p></div></div><div class="top"><p class="src"><a name="v:sendPing" class="def">sendPing</a> :: <a href="Network-WebSockets.html#t:WebSocketsData">WebSocketsData</a> a =&gt; <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send a ping</p></div></div><div class="top"><p class="src"><a name="v:forkPingThread" class="def">forkPingThread</a> :: <a href="Network-WebSockets-Connection.html#t:Connection">Connection</a> -&gt; <a href="../base-4.7.0.2/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Forks a ping thread, sending a ping message every <code>n</code> seconds over the
 connection. The thread dies silently if the connection crashes or is closed.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.14.3</p></div></body></html>