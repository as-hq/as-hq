<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>System.Daemon</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_System-Daemon.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">daemons-0.2.1: Daemons in Haskell made fun and easy</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell98</td></tr></table><p class="caption">System.Daemon</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Daemons</a></li><li><a href="#g:2">Clients,</a></li><li><a href="#g:3">Types</a></li><li><a href="#g:4">Helpers</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>An RPC-like interface for daemons is provided by
 <code><a href="System-Daemon.html#v:ensureDaemonRunning">ensureDaemonRunning</a></code> and <code><a href="System-Daemon.html#v:runClient">runClient</a></code>.</p><p>A more versatile interface that lets you supply your own <code><a href="Control-Pipe-Socket.html#t:Handler">Handler</a></code>
 is provided by <code><a href="System-Daemon.html#v:ensureDaemonWithHandlerRunning">ensureDaemonWithHandlerRunning</a></code> and
 <code><a href="System-Daemon.html#v:runClientWithHandler">runClientWithHandler</a></code>.  These are useful if, for instance, you
 need streaming requests or replies, or if you need to change your
 event handler at runtime.</p><p>The event handling loop is provided by <code><a href="System-Daemon.html#v:runInForeground">runInForeground</a></code>.  You may
 want to use this for debugging purposes or if you want to handle
 daemonization manually.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:ensureDaemonRunning">ensureDaemonRunning</a> :: (<a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> a, <a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> b) =&gt; <a href="../base-4.7.0.2/Data-String.html#t:String">String</a> -&gt; <a href="System-Daemon.html#t:DaemonOptions">DaemonOptions</a> -&gt; (a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> b) -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:ensureDaemonWithHandlerRunning">ensureDaemonWithHandlerRunning</a> :: <a href="../base-4.7.0.2/Data-String.html#t:String">String</a> -&gt; <a href="System-Daemon.html#t:DaemonOptions">DaemonOptions</a> -&gt; <a href="Control-Pipe-Socket.html#t:Handler">Handler</a> () -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:runClient">runClient</a> :: (<a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> a, <a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> b) =&gt; <a href="System-Daemon.html#t:HostName">HostName</a> -&gt; <a href="System-Daemon.html#t:Port">Port</a> -&gt; a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> (<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> b)</li><li class="src short"><a href="#v:runClientWithHandler">runClientWithHandler</a> ::  <a href="System-Daemon.html#t:HostName">HostName</a> -&gt; <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="Control-Pipe-Socket.html#t:Handler">Handler</a> a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> a</li><li class="src short"><span class="keyword">data</span> <a href="#t:DaemonOptions">DaemonOptions</a> = <a href="#v:DaemonOptions">DaemonOptions</a> {<ul class="subs"><li><a href="#v:daemonPort">daemonPort</a> :: <a href="System-Daemon.html#t:Port">Port</a></li><li><a href="#v:daemonPidFile">daemonPidFile</a> :: <a href="System-Daemon.html#t:PidFile">PidFile</a></li><li><a href="#v:printOnDaemonStarted">printOnDaemonStarted</a> :: <a href="../base-4.7.0.2/Data-Bool.html#t:Bool">Bool</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:PidFile">PidFile</a><ul class="subs"><li>= <a href="#v:InHome">InHome</a></li><li>| <a href="#v:PidFile">PidFile</a> <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a></li></ul></li><li class="src short"><span class="keyword">type</span> <a href="#t:HostName">HostName</a> = <a href="../base-4.7.0.2/Data-String.html#t:String">String</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:Port">Port</a> = <a href="../base-4.7.0.2/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:runInForeground">runInForeground</a> :: <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="Control-Pipe-Socket.html#t:Handler">Handler</a> () -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:bindPort">bindPort</a> :: <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="../network-2.6.2.1/Network-Socket.html#t:Socket">Socket</a></li><li class="src short"><a href="#v:getSocket">getSocket</a> :: <a href="System-Daemon.html#t:HostName">HostName</a> -&gt; <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="../network-2.6.2.1/Network-Socket.html#t:Socket">Socket</a></li></ul></div><div id="interface"><h1 id="g:1">Daemons</h1><div class="top"><p class="src"><a name="v:ensureDaemonRunning" class="def">ensureDaemonRunning</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> a, <a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="../base-4.7.0.2/Data-String.html#t:String">String</a></td><td class="doc"><p>name</p></td></tr><tr><td class="src">-&gt; <a href="System-Daemon.html#t:DaemonOptions">DaemonOptions</a></td><td class="doc"><p>options</p></td></tr><tr><td class="src">-&gt; (a -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> b)</td><td class="doc"><p>handler</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Simple wrapper around <code><a href="System-Daemon.html#v:ensureDaemonWithHandlerRunning">ensureDaemonWithHandlerRunning</a></code> which uses
 a simple function to respond to commands and doesn't deal with
 pipes.</p><p>The <code>handler</code> is just a function that takes a command and returns a
 response.</p></div></div><div class="top"><p class="src"><a name="v:ensureDaemonWithHandlerRunning" class="def">ensureDaemonWithHandlerRunning</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.7.0.2/Data-String.html#t:String">String</a></td><td class="doc"><p>name</p></td></tr><tr><td class="src">-&gt; <a href="System-Daemon.html#t:DaemonOptions">DaemonOptions</a></td><td class="doc"><p>options</p></td></tr><tr><td class="src">-&gt; <a href="Control-Pipe-Socket.html#t:Handler">Handler</a> ()</td><td class="doc"><p>handler</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Start a daemon running on the given port, using the given handler
 to respond to events.  If the daemon is already running, don't do
 anything.  Returns immediately.</p><p>The pidfile <code>PidFile options</code> will be created and locked.  This
 function checks the pidfile to see if the daemon is already
 running.</p><p>The daemon will listen for incoming connections on all interfaces
 on <code>daemonPort options</code>.</p><p>The <code>handler</code> is a function that takes the reader and writer
 <code>ByteString</code> pipes and does something with them.  See
 <code><a href="Control-Pipe-C3.html#v:commandReceiver">commandReceiver</a></code> for an example handler.</p></div></div><h1 id="g:2">Clients,</h1><div class="top"><p class="src"><a name="v:runClient" class="def">runClient</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: (<a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> a, <a href="../cereal-0.4.1.1/Data-Serialize.html#t:Serialize">Serialize</a> b)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">=&gt; <a href="System-Daemon.html#t:HostName">HostName</a></td><td class="doc"><p>hostname</p></td></tr><tr><td class="src">-&gt; <a href="System-Daemon.html#t:Port">Port</a></td><td class="doc"><p>port</p></td></tr><tr><td class="src">-&gt; a</td><td class="doc"><p>command</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> (<a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> b)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Send a command to the daemon running at the given network address
 and wait for a response.</p><p>This is a simple wrapper around <code><a href="System-Daemon.html#v:runClientWithHandler">runClientWithHandler</a></code> that sends a
 single command and waits for a single response.</p><p>If the connection is closed before receiving a response, return
 <code><a href="../base-4.7.0.2/Data-Maybe.html#v:Nothing">Nothing</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:runClientWithHandler" class="def">runClientWithHandler</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="System-Daemon.html#t:HostName">HostName</a></td><td class="doc"><p>hostname</p></td></tr><tr><td class="src">-&gt; <a href="System-Daemon.html#t:Port">Port</a></td><td class="doc"><p>port</p></td></tr><tr><td class="src">-&gt; <a href="Control-Pipe-Socket.html#t:Handler">Handler</a> a</td><td class="doc"><p>command</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> a</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Connect to the given network address and run the handler on the
 reader and wrier pipes for the socket.</p><p>The <code>handler</code> is a function that takes the reader and writer
 <code>ByteString</code> pipes and does something with them.  For an example
 handler, see <code><a href="Control-Pipe-C3.html#v:commandSender">commandSender</a></code>, which sends a command and waits for a
 response.</p></div></div><h1 id="g:3">Types</h1><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:DaemonOptions" class="def">DaemonOptions</a></p><div class="doc"><p>The configuration options of a daemon.  See <code><a href="System-Daemon.html#v:ensureDaemonRunning">ensureDaemonRunning</a></code>
 for a description of each.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:DaemonOptions" class="def">DaemonOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:daemonPort" class="def">daemonPort</a> :: <a href="System-Daemon.html#t:Port">Port</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:daemonPidFile" class="def">daemonPidFile</a> :: <a href="System-Daemon.html#t:PidFile">PidFile</a></dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:printOnDaemonStarted" class="def">printOnDaemonStarted</a> :: <a href="../base-4.7.0.2/Data-Bool.html#t:Bool">Bool</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:DaemonOptions" class="caption collapser" onclick="toggleSection('i:DaemonOptions')">Instances</p><div id="section.i:DaemonOptions" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Text-Show.html#t:Show">Show</a> <a href="System-Daemon.html#t:DaemonOptions">DaemonOptions</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="../data-default-0.5.3/Data-Default.html#t:Default">Default</a> <a href="System-Daemon.html#t:DaemonOptions">DaemonOptions</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:PidFile" class="def">PidFile</a></p><div class="doc"><p>The location of the daemon's pidfile.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:InHome" class="def">InHome</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:PidFile" class="def">PidFile</a> <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:PidFile" class="caption collapser" onclick="toggleSection('i:PidFile')">Instances</p><div id="section.i:PidFile" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Text-Show.html#t:Show">Show</a> <a href="System-Daemon.html#t:PidFile">PidFile</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="../base-4.7.0.2/Data-String.html#t:IsString">IsString</a> <a href="System-Daemon.html#t:PidFile">PidFile</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:HostName" class="def">HostName</a> = <a href="../base-4.7.0.2/Data-String.html#t:String">String</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a name="t:Port" class="def">Port</a> = <a href="../base-4.7.0.2/Data-Int.html#t:Int">Int</a></p></div><h1 id="g:4">Helpers</h1><div class="top"><p class="src"><a name="v:runInForeground" class="def">runInForeground</a> :: <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="Control-Pipe-Socket.html#t:Handler">Handler</a> () -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Start the given handler in the foreground.  It will listen and
 respond to events on the given port.</p><p>This is the function that <code><a href="System-Daemon.html#v:ensureDaemonWithHandlerRunning">ensureDaemonWithHandlerRunning</a></code> runs on
 the daemon thread.</p></div></div><div class="top"><p class="src"><a name="v:bindPort" class="def">bindPort</a> :: <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="../network-2.6.2.1/Network-Socket.html#t:Socket">Socket</a></p><div class="doc"><p>Create a socket and bind it to the given port.</p></div></div><div class="top"><p class="src"><a name="v:getSocket" class="def">getSocket</a> :: <a href="System-Daemon.html#t:HostName">HostName</a> -&gt; <a href="System-Daemon.html#t:Port">Port</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="../network-2.6.2.1/Network-Socket.html#t:Socket">Socket</a></p><div class="doc"><p>Create a socket connected to the given network address.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.14.3</p></div></body></html>