<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>System.Posix.Daemon</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_System-Posix-Daemon.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">daemons-0.2.1: Daemons in Haskell made fun and easy</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell98</td></tr></table><p class="caption">System.Posix.Daemon</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Starting</a></li><li><a href="#g:2">Status</a></li><li><a href="#g:3">Stopping</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module provides a simple interface to creating, checking the
 status of, and stopping background jobs.</p><p>Use <code><a href="System-Posix-Daemon.html#v:runDetached">runDetached</a></code> to start a background job.  For instance, here is
 a daemon that peridically hits a webserver:</p><pre>import Control.Concurrent
import Control.Monad
import Data.Default
import Data.Maybe
import Network.BSD
import Network.HTTP
import Network.URI
import System.Posix.Daemon

main :: IO ()
main = runDetached (Just &quot;diydns.pid&quot;) def $ forever $ do
    hostname &lt;- getHostName
    _ &lt;- simpleHTTP
             (Request { rqURI     = fromJust (parseURI &quot;http://foo.com/dns&quot;)
                      , rqMethod  = GET
                      , rqHeaders = []
                      , rqBody    = hostname })
    threadDelay (600 * 1000 * 1000)</pre><p>To check if the above job is running, use <code><a href="System-Posix-Daemon.html#v:isRunning">isRunning</a></code> with the same
 pidfile:</p><pre>isRunning &quot;diydns.pid&quot;</pre><p>Finally, to stop the above job (maybe because we're rolling a new
 version of it), use <code><a href="System-Posix-Daemon.html#v:kill">kill</a></code>:</p><pre>kill &quot;diydns.pid&quot;</pre><p>To stop a job and wait for it to close (and release its pidfile), use
 <code><a href="System-Posix-Daemon.html#v:killAndWait">killAndWait</a></code>:</p><pre>killAndWait &quot;diydns.pid&quot; &gt;&gt; doSomething</pre><p>As a side note, the code above is a script that the author uses as
 a sort of homebrew dynamic DNS: the remote address is a CGI script
 that records the IP addresses of all incoming requests in separate
 files named after the contents of the requests; the addresses are
 then viewable with any browser.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:runDetached">runDetached</a> :: <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="System-Posix-Daemon.html#t:Redirection">Redirection</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> () -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:Redirection">Redirection</a><ul class="subs"><li>= <a href="#v:DevNull">DevNull</a></li><li>| <a href="#v:ToFile">ToFile</a> <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a></li></ul></li><li class="src short"><a href="#v:isRunning">isRunning</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="../base-4.7.0.2/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:kill">kill</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:killAndWait">killAndWait</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:brutalKill">brutalKill</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</li></ul></div><div id="interface"><h1 id="g:1">Starting</h1><div class="top"><p class="src"><a name="v:runDetached" class="def">runDetached</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.7.0.2/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a></td><td class="doc"><p>pidfile</p></td></tr><tr><td class="src">-&gt; <a href="System-Posix-Daemon.html#t:Redirection">Redirection</a></td><td class="doc"><p>redirection</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</td><td class="doc"><p>program</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Run the given action detached from the current terminal; this
 creates an entirely new process.  This function returns
 immediately.  Uses the double-fork technique to create a well
 behaved daemon.  If <code>pidfile</code> is given, check/write it; if we
 cannot obtain a lock on the file, another process is already using
 it, so fail.  The <code>redirection</code> parameter controls what to do with
 the standard channels (<code>stdin</code>, <code>stderr</code>, and <code>stdout</code>).</p><p>See: <a href="http://www.enderunix.org/docs/eng/daemon.php">http://www.enderunix.org/docs/eng/daemon.php</a></p><p>Note: All unnecessary fds should be close before calling this.
 Otherwise, you get an fd leak.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Redirection" class="def">Redirection</a></p><div class="doc"><p>Where should the output (and input) of a daemon be redirected to?
 (we can't just leave it to the current terminal, because it may be
 closed, and that would kill the daemon).</p><p>When in doubt, just use <code><a href="../data-default-0.5.3/Data-Default.html#v:def">def</a></code>, the default value.</p><p><code><a href="System-Posix-Daemon.html#v:DevNull">DevNull</a></code> causes the output to be redirected to <code>/dev/null</code>.  This
 is safe and is what you want in most cases.</p><p>If you don't want to lose the output (maybe because you're using it
 for logging), use <code><a href="System-Posix-Daemon.html#v:ToFile">ToFile</a></code>, instead.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:DevNull" class="def">DevNull</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:ToFile" class="def">ToFile</a> <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:Redirection" class="caption collapser" onclick="toggleSection('i:Redirection')">Instances</p><div id="section.i:Redirection" class="show"><table><tr><td class="src"><a href="../base-4.7.0.2/Text-Show.html#t:Show">Show</a> <a href="System-Posix-Daemon.html#t:Redirection">Redirection</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="../data-default-0.5.3/Data-Default.html#t:Default">Default</a> <a href="System-Posix-Daemon.html#t:Redirection">Redirection</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h1 id="g:2">Status</h1><div class="top"><p class="src"><a name="v:isRunning" class="def">isRunning</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> <a href="../base-4.7.0.2/Data-Bool.html#t:Bool">Bool</a></p><div class="doc"><p>Return <code><a href="../base-4.7.0.2/Data-Bool.html#v:True">True</a></code> if the given file is locked by a process.  In our
 case, returns <code><a href="../base-4.7.0.2/Data-Bool.html#v:True">True</a></code> when the daemon that created the file is still
 alive.</p></div></div><h1 id="g:3">Stopping</h1><div class="top"><p class="src"><a name="v:kill" class="def">kill</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send <code><a href="../unix-2.7.1.0/System-Posix-Signals.html#v:sigQUIT">sigQUIT</a></code> to the process recorded in the pidfile.  This
 gives the process a chance to close cleanly.</p></div></div><div class="top"><p class="src"><a name="v:killAndWait" class="def">killAndWait</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Kill a process and wait for it to release its pidfile</p></div></div><div class="top"><p class="src"><a name="v:brutalKill" class="def">brutalKill</a> :: <a href="../base-4.7.0.2/System-IO.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.7.0.2/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Send <code><a href="../unix-2.7.1.0/System-Posix-Signals.html#v:sigKILL">sigKILL</a></code> to the process recorded in the pidfile.  This
 immediately kills the process.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.14.3</p></div></body></html>